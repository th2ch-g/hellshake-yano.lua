# title: è¡¨ç¤ºå¹…ã‚’è€ƒæ…®ã—ãŸéš£æ¥åˆ¤å®šã®å®Ÿè£…

## æ¦‚è¦
- è¨˜å·ãƒ»ã‚¿ãƒ–æ–‡å­—ãƒ»æ—¥æœ¬èªã‚„ã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆã‚’å«ã‚€ãƒ†ã‚­ã‚¹ãƒˆã§ã€å®Ÿéš›ã«ã¯é‡ãªã‚‰ãªã„å˜èªãŒã€Œéš£æ¥ã—ã¦ã„ã‚‹ã€ã¨èª¤åˆ¤å®šã•ã‚Œã€ãƒ’ãƒ³ãƒˆãŒè¡¨ç¤ºã•ã‚Œãªã„å•é¡Œã‚’ä¿®æ­£

### goal
- ã‚¿ãƒ–æ–‡å­—å¾Œã®æ—¥æœ¬èªå˜èªã«ã‚‚æ­£ã—ããƒ’ãƒ³ãƒˆãŒè¡¨ç¤ºã•ã‚Œã‚‹
  - ã‚¿ãƒ–æ–‡å­—ãŒãªãã¦ã‚‚ã€ãƒ’ãƒ³ãƒˆãŒé‡ãªã‚‰ãªã‘ã‚Œã°è¡¨ç¤ºã™ã‚‹
  - ã‚¿ãƒ–æ–‡å­—ã®è¡¨ç¤ºå¹…ã‚’è€ƒæ…®ã—ã¦éš£æ¥åˆ¤å®šã‚’è¡Œã†
  - è¨˜å·ã¨æ–‡å­—ã®å ´åˆã¯æ–‡å­—ã‚’å„ªå…ˆã™ã‚‹
- å®Ÿéš›ã®è¡¨ç¤ºä½ç½®ã«åŸºã¥ã„ãŸæ­£ç¢ºãªéš£æ¥åˆ¤å®šã‚’å®Ÿç¾
- ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ã‚„ã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆã•ã‚ŒãŸã‚³ãƒ¼ãƒ‰ã§ã®ä½¿ç”¨æ€§å‘ä¸Š
- **ãƒ’ãƒ³ãƒˆã®è¡¨ç¤ºä½ç½®ãŒæ­£ç¢ºã«å˜èªã®ä½ç½®ã«ä¸€è‡´ã™ã‚‹ã“ã¨**
  - æ—¥æœ¬èªæ–‡å­—ã®ä¸Šã«ãƒ’ãƒ³ãƒˆãŒé‡ãªã‚‰ãªã„
  - ã‚¿ãƒ–æ–‡å­—ã‚’å«ã‚€è¡Œã§ã‚‚æ­£ã—ã„åˆ—ä½ç½®ã«ãƒ’ãƒ³ãƒˆã‚’è¡¨ç¤º
  - è¡¨ç¤ºå¹…ãƒ™ãƒ¼ã‚¹ã§ãƒ’ãƒ³ãƒˆä½ç½®ã‚’è¨ˆç®—ã—ã€è¦–è¦šçš„ã«æ­£ç¢ºãªé…ç½®ã‚’å®Ÿç¾

## å¿…é ˆã®ãƒ«ãƒ¼ãƒ«
- å¿…ãš `CLAUDE.md` ã‚’å‚ç…§ã—ã€ãƒ«ãƒ¼ãƒ«ã‚’å®ˆã‚‹ã“ã¨
- UTF-8ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚’å‰æã¨ã™ã‚‹
- æ—¢å­˜ã®APIã¨ã®å¾Œæ–¹äº’æ›æ€§ã‚’ç¶­æŒã™ã‚‹

## é–‹ç™ºã®ã‚´ãƒ¼ãƒ«
- ã‚¿ãƒ–æ–‡å­—ã¨æ—¥æœ¬èªæ–‡å­—ã®è¡¨ç¤ºå¹…ã‚’æ­£ç¢ºã«è¨ˆç®—
- éš£æ¥åˆ¤å®šã®ç²¾åº¦ã‚’100%ã«æ”¹å–„
- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã¸ã®å½±éŸ¿ã‚’æœ€å°é™ã«æŠ‘ãˆã‚‹ï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®æ´»ç”¨ï¼‰

## å®Ÿè£…ä»•æ§˜

### å•é¡Œã®è©³ç´°
1. **ç¾çŠ¶ã®å•é¡Œ**
   - `detectAdjacentWords`é–¢æ•°ã§çµ‚äº†ä½ç½®ã‚’`word.col + word.text.length - 1`ã§è¨ˆç®—
   - æ–‡å­—æ•°ã¨è¡¨ç¤ºå¹…ã®æ··åŒã«ã‚ˆã‚Šä½ç½®è¨ˆç®—ãŒä¸æ­£ç¢º
   - ã‚¿ãƒ–æ–‡å­—ï¼ˆè¡¨ç¤ºå¹…4-8ï¼‰ã‚’1æ–‡å­—ã¨ã—ã¦æ‰±ã£ã¦ã„ã‚‹
   - æ—¥æœ¬èªæ–‡å­—ï¼ˆè¡¨ç¤ºå¹…2ï¼‰ã‚’1æ–‡å­—ã¨ã—ã¦æ‰±ã£ã¦ã„ã‚‹

2. **å…·ä½“ä¾‹**
   ```
   \t- [ ] æç”»ä¸­ã®å…¥åŠ›å‡¦ç†æ™‚é–“
   ```
   - `\t`ã®text.length=1ã ãŒã€è¡¨ç¤ºå¹…=8
   - `æç”»`ãŒéš£æ¥ã—ã¦ã„ã‚‹ã¨èª¤åˆ¤å®šã•ã‚Œã‚‹

3. **ä¿®æ­£æ–¹é‡**
   - è¡¨ç¤ºå¹…è¨ˆç®—é–¢æ•°ã®æ–°è¦ä½œæˆ
   - éš£æ¥åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯ã‚’è¡¨ç¤ºå¹…ãƒ™ãƒ¼ã‚¹ã«å¤‰æ›´
   - Wordå‹ã¸ã®è¡¨ç¤ºå¹…æƒ…å ±ã®è¿½åŠ ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

4. **ãƒ’ãƒ³ãƒˆä½ç½®ã®ã‚ºãƒ¬å•é¡Œï¼ˆã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã‚ˆã‚Šï¼‰**
   - **ç¾çŠ¶**: ãƒ’ãƒ³ãƒˆãŒæ—¥æœ¬èªæ–‡å­—ã®ä¸Šã«é‡ãªã£ã¦è¡¨ç¤ºã•ã‚Œã‚‹
   - **åŸå› **: ãƒ’ãƒ³ãƒˆä½ç½®è¨ˆç®—ãŒæ–‡å­—æ•°ãƒ™ãƒ¼ã‚¹ã§è¡Œã‚ã‚Œã¦ã„ã‚‹
   - **å½±éŸ¿**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ’ãƒ³ãƒˆã¨å¯¾è±¡å˜èªã®å¯¾å¿œé–¢ä¿‚ã‚’èªè­˜ã§ããªã„
   - **å¿…è¦ãªä¿®æ­£**:
     - è¡¨ç¤ºå¹…ã‚’è€ƒæ…®ã—ãŸãƒ’ãƒ³ãƒˆä½ç½®è¨ˆç®—ã®å®Ÿè£…
     - `word.col`ã®å€¤è‡ªä½“ã‚’è¡¨ç¤ºå¹…ãƒ™ãƒ¼ã‚¹ã«å¤‰æ›
     - ãƒ’ãƒ³ãƒˆæç”»æ™‚ã®åˆ—ä½ç½®è¨ˆç®—ã‚’ä¿®æ­£

5. **æ–‡é ­ãƒ’ãƒ³ãƒˆä½ç½®ã®äºŒé‡å¤‰æ›å•é¡Œï¼ˆèª¿æŸ»ã«ã‚ˆã‚Šåˆ¤æ˜ï¼‰**
   - **ç¾çŠ¶**: æ–‡é ­ã®ãƒ’ãƒ³ãƒˆä½ç½®ãŒãšã‚Œã¦è¡¨ç¤ºã•ã‚Œã‚‹
   - **åŸå› **:
     - Word.colã¯ã€Œ1ãƒ™ãƒ¼ã‚¹ã€è¡¨ç¤ºåˆ—ä½ç½®ã€ã¨ã—ã¦å®šç¾©æ¸ˆã¿
     - convertToDisplayColumné–¢æ•°ã§ã•ã‚‰ã«+1ã—ã¦ã„ã‚‹ï¼ˆäºŒé‡å¤‰æ›ï¼‰
   - **å½±éŸ¿**: æ–‡é ­ã®ãƒ’ãƒ³ãƒˆãŒæ­£ã—ã„ä½ç½®ã«è¡¨ç¤ºã•ã‚Œãªã„
   - **å¿…è¦ãªä¿®æ­£**:
     - convertToDisplayColumné–¢æ•°ã®+1å‡¦ç†ã‚’å‰Šé™¤
     - Wordç”Ÿæˆæ™‚ã®åˆ—ä½ç½®è¨ˆç®—ã®æ¤œè¨¼ã¨ä¿®æ­£

6. **è¨˜å·ã¨æ–‡å­—ã®éš£æ¥æ™‚ã®ãƒ’ãƒ³ãƒˆéè¡¨ç¤ºå•é¡Œï¼ˆæ–°è¦ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã‚ˆã‚Šï¼‰**
   - **ç¾çŠ¶**: ã€Œâ‘£sub2ã€ã®ã‚ˆã†ãªè¨˜å·ã¨æ–‡å­—ã®çµ„ã¿åˆã‚ã›ã§ãƒ’ãƒ³ãƒˆãŒè¡¨ç¤ºã•ã‚Œãªã„
   - **åŸå› **:
     - ç‹­ã„ã‚¹ãƒšãƒ¼ã‚¹ã§2ã¤ã®ãƒ’ãƒ³ãƒˆã‚’è¡¨ç¤ºã™ã‚‹å¹…ãŒãªã„å ´åˆã®å‡¦ç†ãŒä¸é©åˆ‡
     - è¨˜å·ï¼ˆç‰¹ã«ä¸¸æ•°å­—ï¼‰ã®è¡¨ç¤ºå¹…è¨ˆç®—ãŒæ­£ç¢ºã§ãªã„
     - ãƒ’ãƒ³ãƒˆè¡¨ç¤ºå¯èƒ½ã‚¹ãƒšãƒ¼ã‚¹ã®åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯ã«å•é¡Œ
   - **å½±éŸ¿**: è¨˜å·ã‚’å«ã‚€æ–‡æ›¸ã§ãƒ’ãƒ³ãƒˆæ©Ÿèƒ½ãŒæ­£ã—ãå‹•ä½œã—ãªã„
   - **å¿…è¦ãªä¿®æ­£**:
     - è¨˜å·ã®è¡¨ç¤ºå¹…ã‚’æ­£ç¢ºã«è¨ˆç®—ï¼ˆå…¨è§’è¨˜å·ã¯å¹…2ã¨ã—ã¦æ‰±ã†ï¼‰
     - æœ€å°è¡¨ç¤ºã‚¹ãƒšãƒ¼ã‚¹ã®åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯è¿½åŠ 
     - éš£æ¥ãƒ’ãƒ³ãƒˆã®å„ªå…ˆé †ä½ä»˜ã‘ï¼ˆè¨˜å·ã‚ˆã‚Šæ–‡å­—ã‚’å„ªå…ˆï¼‰

7. **å†æç”»é…å»¶å•é¡Œï¼ˆã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã‚ˆã‚Šï¼‰**
   - **ç¾çŠ¶**: 1æ–‡å­—å…¥åŠ›å¾Œã€2æ–‡å­—ç›®ã®å…¥åŠ›ã¾ã§å†æç”»ã‚’å¾…ã¤å¿…è¦ãŒã‚ã‚‹
   - **åŸå› **:
     - ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ãŒä¸é©åˆ‡
     - éåŒæœŸå‡¦ç†ã®å¾…æ©Ÿæ™‚é–“ãŒé•·ã„
   - **å½±éŸ¿**: å…¥åŠ›ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒæ‚ªãã€ãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£ãŒä½ä¸‹
   - **å¿…è¦ãªä¿®æ­£**:
     - ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç®¡ç†ã®æœ€é©åŒ–
     - éåŒæœŸå‡¦ç†ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°èª¿æ•´

8. **Word.colã®æ–‡å­—ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹/è¡¨ç¤ºå¹…ä¸æ•´åˆå•é¡Œï¼ˆèª¿æŸ»ã«ã‚ˆã‚Šåˆ¤æ˜ï¼‰**
   - **ç¾çŠ¶**: ã‚¿ãƒ–æ–‡å­—ãªã—ã®è¡Œã§è¨˜å·ã¨æ–‡å­—ã®å¢ƒç•Œã§ãƒ’ãƒ³ãƒˆãŒè¡¨ç¤ºã•ã‚Œãªã„
   - **åŸå› **:
     - detector.tsã§Wordç”Ÿæˆæ™‚ã«`col: match.index + 1`ï¼ˆæ–‡å­—ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãƒ™ãƒ¼ã‚¹ï¼‰
     - ã—ã‹ã—ã€ãƒ’ãƒ³ãƒˆä½ç½®è¨ˆç®—ã¯è¡¨ç¤ºå¹…ãƒ™ãƒ¼ã‚¹ã¨ã—ã¦Word.colã‚’æ‰±ã£ã¦ã„ã‚‹
     - ã‚¿ãƒ–æ–‡å­—ã‚„å…¨è§’æ–‡å­—ã‚’å«ã‚€å ´åˆã€æ–‡å­—ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã¨è¡¨ç¤ºå¹…ãŒä¸€è‡´ã—ãªã„
   - **å½±éŸ¿**:
     - ã€Œâ–¡ è¨˜å·vsæ–‡å­—ã®ã€ã®ã‚ˆã†ãªè¡Œã§ãƒ’ãƒ³ãƒˆãŒæ­£ã—ãè¡¨ç¤ºã•ã‚Œãªã„
     - ã‚¿ãƒ–æ–‡å­—ã®æœ‰ç„¡ã§æŒ™å‹•ãŒç•°ãªã‚‹
   - **å¿…è¦ãªä¿®æ­£**:
     - Wordç”Ÿæˆæ™‚ã«åˆ—ä½ç½®ã‚’è¡¨ç¤ºå¹…ãƒ™ãƒ¼ã‚¹ã«å¤‰æ›
     - convertToDisplayColumné–¢æ•°ã‚’ä½¿ç”¨ã—ã¦æ­£ç¢ºãªè¡¨ç¤ºåˆ—ã‚’è¨ˆç®—

## ç”ŸæˆAIã®å­¦ç¿’ç”¨ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ

### TypeScriptãƒ•ã‚¡ã‚¤ãƒ«
- `denops/hellshake-yano/hint.ts`
  - 1137-1204è¡Œ: `detectAdjacentWords`é–¢æ•°
  - 1231-1268è¡Œ: `shouldSkipHintForOverlap`é–¢æ•°
- `denops/hellshake-yano/types.ts`
  - 35-44è¡Œ: `Word`ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å®šç¾©
- `denops/hellshake-yano/utils/encoding.ts`
  - æ—¢å­˜ã®ãƒã‚¤ãƒˆæ•°è¨ˆç®—é–¢æ•°

## Process

### process1 è¡¨ç¤ºå¹…è¨ˆç®—æ©Ÿèƒ½ã®å®Ÿè£…ã€TDD Red-Green-Refactorã€‘
#### sub1 è¡¨ç¤ºå¹…è¨ˆç®—é–¢æ•°ã®ä½œæˆ
@target: denops/hellshake-yano/utils/display.tsï¼ˆæ–°è¦ä½œæˆï¼‰
@test: denops/hellshake-yano/utils/display.test.tsï¼ˆæ–°è¦ä½œæˆï¼‰
@ref: denops/hellshake-yano/utils/cache.tsï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿæ§‹ï¼‰
@ref: denops/hellshake-yano/utils/encoding.tsï¼ˆæ—¢å­˜ã®ãƒã‚¤ãƒˆæ•°è¨ˆç®—ï¼‰

##### ğŸ”´ Red Phase: ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆï¼ˆ26ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ï¼‰
- [x] **åŸºæœ¬ASCIIæ–‡å­—ãƒ†ã‚¹ãƒˆï¼ˆ5ã‚±ãƒ¼ã‚¹ï¼‰**
  - [x] `"hello"` â†’ 5
  - [x] `"Hello World"` â†’ 11
  - [x] `"123"` â†’ 3
  - [x] `"!@#$%"` â†’ 5
  - [x] ç©ºæ–‡å­—åˆ— `""` â†’ 0
- [x] **ã‚¿ãƒ–æ–‡å­—ãƒ†ã‚¹ãƒˆï¼ˆ5ã‚±ãƒ¼ã‚¹ï¼‰**
  - [x] `"\t"` â†’ 8ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰
  - [x] `"hello\tworld"` â†’ 13ï¼ˆ5+8ï¼‰
  - [x] `"\t\t"` â†’ 16ï¼ˆ8+8ï¼‰
  - [x] `"a\tb\tc"` â†’ 17ï¼ˆ1+8+1+8+1ï¼‰
  - [x] ã‚«ã‚¹ã‚¿ãƒ ã‚¿ãƒ–å¹…4: `"\t"` â†’ 4
- [x] **æ—¥æœ¬èªãƒ»å…¨è§’æ–‡å­—ãƒ†ã‚¹ãƒˆï¼ˆ5ã‚±ãƒ¼ã‚¹ï¼‰**
  - [x] `"ã‚"` â†’ 2
  - [x] `"ã“ã‚“ã«ã¡ã¯"` â†’ 10ï¼ˆ2Ã—5ï¼‰
  - [x] `"æ¼¢å­—"` â†’ 4ï¼ˆ2Ã—2ï¼‰
  - [x] `"ï½ï½‚ï½ƒ"` â†’ 6ï¼ˆå…¨è§’è‹±æ•°ï¼‰
  - [x] `"\tæç”»"` â†’ 12ï¼ˆ8+2+2ï¼‰
- [x] **çµµæ–‡å­—ãƒ»ç‰¹æ®Šæ–‡å­—ãƒ†ã‚¹ãƒˆï¼ˆ5ã‚±ãƒ¼ã‚¹ï¼‰**
  - [x] `"ğŸ˜€"` â†’ 2ï¼ˆå˜ç´”çµµæ–‡å­—ï¼‰
  - [x] `"ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦"` â†’ 2ï¼ˆZWJçµåˆï¼‰
  - [x] `"ğŸ‡¯ğŸ‡µ"` â†’ 2ï¼ˆå›½æ——ï¼‰
  - [x] `"Ã©"` â†’ 1ï¼ˆçµåˆæ–‡å­—ï¼‰
  - [x] `"â†’â†â†‘â†“"` â†’ 8ï¼ˆçŸ¢å°è¨˜å·ã€å„2ï¼‰
- [x] **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãƒ†ã‚¹ãƒˆï¼ˆ6ã‚±ãƒ¼ã‚¹ï¼‰**
  - [x] nullå…¥åŠ› â†’ 0
  - [x] undefinedå…¥åŠ› â†’ 0
  - [x] ç„¡åŠ¹ãªUTF-8 â†’ fallbackå‡¦ç†
  - [x] éå¸¸ã«é•·ã„æ–‡å­—åˆ—ï¼ˆ10000æ–‡å­—ï¼‰
  - [x] ã‚µãƒ­ã‚²ãƒ¼ãƒˆãƒšã‚¢å‡¦ç†
  - [x] åˆ¶å¾¡æ–‡å­—ã®å‡¦ç†

##### ğŸŸ¢ Green Phase: æœ€å°é™ã®å®Ÿè£…ï¼ˆ3æ®µéšï¼‰
- [x] **Stage 1: åŸºæœ¬å®Ÿè£…**
  - [x] `getCharDisplayWidth`é–¢æ•°ã®å®Ÿè£…
    - ASCIIåˆ¤å®š: 0x20-0x7E â†’ 1
    - ã‚¿ãƒ–æ–‡å­—: 0x09 â†’ tabWidth
    - ç°¡æ˜“Unicodeåˆ¤å®š: codePoint > 0xFF â†’ 2
  - [x] `getDisplayWidth`é–¢æ•°ã®å®Ÿè£…
    - æ–‡å­—åˆ—ã‚’ã‚³ãƒ¼ãƒ‰ãƒã‚¤ãƒ³ãƒˆã§åˆ†å‰²
    - å„æ–‡å­—ã®å¹…ã‚’åˆè¨ˆ
- [x] **Stage 2: ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿæ§‹**
  - [x] `createDisplayWidthCache`é–¢æ•°ã®å®Ÿè£…
    - æ—¢å­˜ã®`utils/cache.ts`ã®LRUCacheæ´»ç”¨
    - ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚­ãƒ¼: `${text}_${tabWidth}`
    - ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚µã‚¤ã‚º: 1000ã‚¨ãƒ³ãƒˆãƒª
- [x] **Stage 3: Unicodeå®Œå…¨å¯¾å¿œ**
  - [x] East Asian Widthå¯¾å¿œ
    - Fullwidth (F), Wide (W) â†’ 2
    - Halfwidth (H), Narrow (Na), Neutral (N), Ambiguous (A) â†’ 1
  - [x] çµåˆæ–‡å­—ãƒ»ZWJå¯¾å¿œ
  - [x] çµµæ–‡å­—ã‚¯ãƒ©ã‚¹ã‚¿å‡¦ç†

##### ğŸ”µ Refactor Phase: æœ€é©åŒ–
- [x] **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–**
  - [x] æ–‡å­—å˜ä½ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥è¿½åŠ 
  - [x] é »å‡ºæ–‡å­—ã®äº‹å‰è¨ˆç®—ãƒ†ãƒ¼ãƒ–ãƒ«
  - [x] ãƒãƒƒãƒå‡¦ç†ã®æœ€é©åŒ–
- [x] **ã‚³ãƒ¼ãƒ‰å“è³ªæ”¹å–„**
  - [x] é–¢æ•°ã®è²¬å‹™åˆ†é›¢
  - [x] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®çµ±ä¸€
  - [x] TypeScriptå‹å®šç¾©ã®å¼·åŒ–
- [x] **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ•´å‚™**
  - [x] JSDocã‚³ãƒ¡ãƒ³ãƒˆã®è¿½åŠ 
  - [x] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç‰¹æ€§ã®æ–‡æ›¸åŒ–

#### sub2 Vimã¨ã®é€£æºæ©Ÿèƒ½ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
@target: denops/hellshake-yano/utils/display.ts
@ref: denops/hellshake-yano/deps.tsï¼ˆDenops APIï¼‰

##### å®Ÿè£…é …ç›®
- [x] `getVimDisplayWidth`é–¢æ•°ã®è¿½åŠ 
  - [x] Vim/Neovimã®`strdisplaywidth()`ã‚’å‘¼ã³å‡ºã™
  - [x] Denops APIã‚’ä½¿ç”¨ã—ãŸå®Ÿè£…
  - [x] ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æ©Ÿèƒ½ä»˜ãï¼ˆTypeScriptå®Ÿè£…ã¸ï¼‰
- [ ] **ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹**
  - [ ] Vimç’°å¢ƒã§ã®å‹•ä½œç¢ºèª
  - [ ] ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‹•ä½œã®ç¢ºèª
  - [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¯”è¼ƒï¼ˆVim vs TypeScriptï¼‰
- [ ] **çµ±åˆã‚ªãƒ—ã‚·ãƒ§ãƒ³**

  - [ ] è¨­å®šã«ã‚ˆã‚‹åˆ‡ã‚Šæ›¿ãˆæ©Ÿèƒ½
  - [ ] è‡ªå‹•åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯ï¼ˆVimåˆ©ç”¨å¯èƒ½æ€§ï¼‰

##### ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³
- [x] **M1**: åŸºæœ¬æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆåˆæ ¼ï¼ˆASCII+ã‚¿ãƒ–ï¼‰- Stage 1å®Œäº†
- [x] **M2**: æ—¥æœ¬èªå¯¾å¿œãƒ†ã‚¹ãƒˆåˆæ ¼ - Stage 2å®Œäº†
- [x] **M3**: å…¨ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹åˆæ ¼ - Stage 3å®Œäº†
- [x] **M4**: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›®æ¨™é”æˆï¼ˆ1æ–‡å­—ã‚ãŸã‚Š1-10nsã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ’ãƒƒãƒˆç‡80%ä»¥ä¸Šï¼‰

### process2 éš£æ¥åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯ã®ä¿®æ­£ã€TDD Red-Green-Refactorã€‘
#### sub1 detectAdjacentWordsé–¢æ•°ã®ä¿®æ­£
@target: denops/hellshake-yano/hint.ts
@test: denops/hellshake-yano/hint.test.tsï¼ˆæ–°è¦ä½œæˆï¼‰
@ref: denops/hellshake-yano/utils/display.ts

##### ğŸ”´ Red Phase: ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆï¼ˆéš£æ¥åˆ¤å®šãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ï¼‰
- [x] **ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆå•é¡Œã®å†ç¾ãƒ†ã‚¹ãƒˆï¼ˆ5ã‚±ãƒ¼ã‚¹ï¼‰**
  - [x] `"0â—‹0EtectAdjacentWords0C"` â†’ ãƒ’ãƒ³ãƒˆãŒæ­£ã—ã„ä½ç½®ã«è¡¨ç¤º
  - [x] `"0â—‹æ–‡å­—æ•°ã¨è¡¨ç¤ºå¹…ã®0RåŒ00ã‚ˆã‚Š0P"` â†’ æ—¥æœ¬èªæ··åœ¨ã§ã®ä½ç½®è¨ˆç®—
  - [x] `"0â—‹0Yãƒ–æ–‡å­—0Xè¡¨ç¤ºå¹…4-8ï¼‰ã‚’0W"` â†’ ã‚¿ãƒ–ã¨æ—¥æœ¬èªã®æ··åœ¨
  - [x] `"Pâ—‹P0æœ¬èªæ–‡å­—P1è¡¨ç¤ºå¹…2ï¼‰ã‚’PE"` â†’ å…¨è§’æ–‡å­—ã®ä½ç½®è¨ˆç®—
  - [x] `"\tæç”»ä¸­ã®å…¥åŠ›å‡¦ç†æ™‚é–“"` â†’ ã‚¿ãƒ–é–‹å§‹è¡Œã®è¡¨ç¤ºå¹…è¨ˆç®—

- [x] **éš£æ¥åˆ¤å®šã®åŸºæœ¬ãƒ†ã‚¹ãƒˆï¼ˆ10ã‚±ãƒ¼ã‚¹ï¼‰**
  - [x] ASCIIæ–‡å­—åŒå£«ã®éš£æ¥åˆ¤å®š
  - [x] ã‚¿ãƒ–æ–‡å­—ã‚’å«ã‚€éš£æ¥åˆ¤å®š
  - [x] æ—¥æœ¬èªæ–‡å­—åŒå£«ã®éš£æ¥åˆ¤å®š
  - [x] ã‚¿ãƒ–ï¼‹æ—¥æœ¬èªã®éš£æ¥åˆ¤å®š
  - [x] æ··åˆæ–‡å­—åˆ—ã§ã®éš£æ¥åˆ¤å®š
  - [x] éš£æ¥ã—ã¦ã„ãªã„å ´åˆï¼ˆè¡¨ç¤ºå¹…ã§é›¢ã‚Œã¦ã„ã‚‹ï¼‰
  - [x] éš£æ¥ã—ã¦ã„ã‚‹å ´åˆï¼ˆè¡¨ç¤ºå¹…ã§éš£ã‚Šåˆã†ï¼‰
  - [x] ã‚ªãƒ¼ãƒãƒ¼ãƒ©ãƒƒãƒ—ã—ã¦ã„ã‚‹å ´åˆ
  - [x] è¡Œé ­ãƒ»è¡Œæœ«ã§ã®éš£æ¥åˆ¤å®š
  - [x] è¤‡æ•°ã‚¿ãƒ–æ–‡å­—ã§ã®éš£æ¥åˆ¤å®š

- [x] **ãƒ’ãƒ³ãƒˆä½ç½®è¨ˆç®—ãƒ†ã‚¹ãƒˆï¼ˆ8ã‚±ãƒ¼ã‚¹ï¼‰**
  - [x] è¡Œé ­ã‹ã‚‰ã®è¡¨ç¤ºå¹…è¨ˆç®—
  - [x] ã‚¿ãƒ–æ–‡å­—å‰ã®ä½ç½®è¨ˆç®—
  - [x] ã‚¿ãƒ–æ–‡å­—å¾Œã®ä½ç½®è¨ˆç®—
  - [x] æ—¥æœ¬èªæ–‡å­—ã®ä½ç½®è¨ˆç®—
  - [x] æ··åˆæ–‡å­—åˆ—ã§ã®å„å˜èªã®ä½ç½®
  - [x] è¤‡æ•°è¡Œã§ã®ä½ç½®è¨ˆç®—
  - [x] ã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆã•ã‚ŒãŸè¡Œã®ä½ç½®è¨ˆç®—
  - [x] è¨˜å·ã‚’å«ã‚€è¡Œã®ä½ç½®è¨ˆç®—

##### ğŸŸ¢ Green Phase: æœ€å°é™ã®å®Ÿè£…ï¼ˆ4æ®µéšï¼‰
- [x] **Stage 1: è¡¨ç¤ºå¹…è¨ˆç®—ã®çµ±åˆ**
  - [x] `getDisplayWidth`ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
  - [x] ã‚¿ãƒ–å¹…è¨­å®šã®å–å¾—ï¼ˆ`&tabstop`ï¼‰
  - [x] ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã®è¨­å®šï¼ˆtabWidth = 8ï¼‰

- [x] **Stage 2: detectAdjacentWordsé–¢æ•°ã®ä¿®æ­£**
  - [x] çµ‚äº†ä½ç½®è¨ˆç®—ã‚’è¡¨ç¤ºå¹…ãƒ™ãƒ¼ã‚¹ã«å¤‰æ›´
    ```typescript
    // Before: word.col + word.text.length - 1
    // After: word.col + getDisplayWidth(word.text, tabWidth) - 1
    ```
  - [x] éš£æ¥åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯ã®æ›´æ–°
  - [x] ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚­ãƒ¼ã«è¡¨ç¤ºå¹…æƒ…å ±ã‚’å«ã‚ã‚‹

- [x] **Stage 3: åˆ—ä½ç½®è¨ˆç®—ã®ä¿®æ­£**
  - [x] `calculateColumnPosition`é–¢æ•°ã®ä½œæˆ
    - è¡Œé ­ã‹ã‚‰ã®ç´¯ç©è¡¨ç¤ºå¹…ã‚’è¨ˆç®—
    - å„å˜èªã®å®Ÿéš›ã®åˆ—ä½ç½®ã‚’æ±ºå®š
  - [x] Wordå‹ã®`col`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è§£é‡ˆã®å¤‰æ›´
    - æ–‡å­—ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‹ã‚‰è¡¨ç¤ºå¹…ãƒ™ãƒ¼ã‚¹ã¸

- [x] **Stage 4: ãƒ’ãƒ³ãƒˆæç”»ä½ç½®ã®ä¿®æ­£**
  - [x] `displayHints`é–¢æ•°ã®æ›´æ–°
  - [x] ä»®æƒ³ãƒ†ã‚­ã‚¹ãƒˆé…ç½®ã®ä½ç½®è¨ˆç®—ä¿®æ­£
  - [x] ã‚ªãƒ•ã‚»ãƒƒãƒˆè¨ˆç®—ã®è¡¨ç¤ºå¹…å¯¾å¿œ

##### ğŸ”µ Refactor Phase: æœ€é©åŒ–ã¨æ”¹å–„
- [x] **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–**
  - [x] è¡¨ç¤ºå¹…è¨ˆç®—çµæœã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥
  - [x] è¡Œå˜ä½ã§ã®è¡¨ç¤ºå¹…ãƒãƒƒãƒ—ä½œæˆ
  - [x] é »ç¹ã«ä½¿ç”¨ã•ã‚Œã‚‹æ–‡å­—åˆ—ã®ãƒ—ãƒªã‚­ãƒ£ãƒƒã‚·ãƒ¥

- [x] **ã‚³ãƒ¼ãƒ‰æ§‹é€ ã®æ”¹å–„**
  - [x] è¡¨ç¤ºå¹…è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯ã®ä¸€å…ƒåŒ–
  - [x] ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°ã®æŠ½å‡º
  - [x] ãƒ†ã‚¹ãƒˆå¯èƒ½ãªå°ã•ã„é–¢æ•°ã¸ã®åˆ†å‰²

- [x] **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**
  - [x] ä¸æ­£ãªåˆ—ä½ç½®ã®æ¤œå‡ºã¨ä¿®æ­£
  - [x] è¡¨ç¤ºå¹…è¨ˆç®—ã‚¨ãƒ©ãƒ¼ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
  - [x] ãƒ‡ãƒãƒƒã‚°ç”¨ãƒ­ã‚°ã®è¿½åŠ 
ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¯”è¼ƒï¼ˆVim vs TypeScriptï¼‰
#### sub2 Wordå‹ã®æ‹¡å¼µã¨ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
@target: denops/hellshake-yano/types.ts
@target: denops/hellshake-yano/hint-utils.tsï¼ˆæ–°è¦ä½œæˆï¼‰

##### å®Ÿè£…é …ç›®
- [x] **Wordå‹ã®æ‹¡å¼µ**
  - [x] `displayWidth?: number`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®è¿½åŠ 
  - [x] `displayCol?: number`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®è¿½åŠ ï¼ˆè¡¨ç¤ºå¹…ãƒ™ãƒ¼ã‚¹ã®åˆ—ä½ç½®ï¼‰

- [x] **ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°ã®ä½œæˆ**
  - [x] `convertToDisplayColumn(line: string, charIndex: number, tabWidth: number): number`
    - æ–‡å­—ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’è¡¨ç¤ºå¹…ãƒ™ãƒ¼ã‚¹ã®åˆ—ä½ç½®ã«å¤‰æ›
  - [x] `getWordDisplayEndCol(word: Word, tabWidth: number): number`
    - å˜èªã®çµ‚äº†ä½ç½®ã‚’è¡¨ç¤ºå¹…ãƒ™ãƒ¼ã‚¹ã§è¨ˆç®—
  - [x] `areWordsAdjacent(word1: Word, word2: Word, tabWidth: number): boolean`
    - 2ã¤ã®å˜èªãŒéš£æ¥ã—ã¦ã„ã‚‹ã‹åˆ¤å®š

##### ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹
- [x] å‹ã®å¾Œæ–¹äº’æ›æ€§ãƒ†ã‚¹ãƒˆ
- [x] ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°ã®å˜ä½“ãƒ†ã‚¹ãƒˆ
- [x] ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ã®ãƒ†ã‚¹ãƒˆ

##### ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³
- [x] **M1**: ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆå•é¡Œã®å†ç¾ãƒ†ã‚¹ãƒˆä½œæˆå®Œäº†
- [x] **M2**: åŸºæœ¬çš„ãªéš£æ¥åˆ¤å®šãŒè¡¨ç¤ºå¹…ãƒ™ãƒ¼ã‚¹ã§å‹•ä½œ
- [x] **M3**: ãƒ’ãƒ³ãƒˆä½ç½®ãŒæ­£ç¢ºã«è¡¨ç¤ºã•ã‚Œã‚‹
- [x] **M4**: å…¨ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹åˆæ ¼ï¼†ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç¶­æŒ

### process2.5 æ–‡é ­ãƒ’ãƒ³ãƒˆä½ç½®ã®ä¿®æ­£ã€ç·Šæ€¥ä¿®æ­£ã€‘âœ… å®Œäº†
#### sub1 convertToDisplayColumné–¢æ•°ã®ä¿®æ­£
@target: denops/hellshake-yano/hint-utils.ts
@ref: denops/hellshake-yano/types.tsï¼ˆWordå‹ã®å®šç¾©ï¼‰

##### ä¿®æ­£å†…å®¹
- [x] **äºŒé‡å¤‰æ›ã®è§£æ¶ˆ**
  ```typescript
  // ä¿®æ­£å‰
  export function convertToDisplayColumn(line: string, charIndex: number, tabWidth = 8): number {
    if (charIndex <= 0) {
      return 1;
    }
    const substring = line.slice(0, charIndex);
    return getDisplayWidth(substring, tabWidth) + 1;  // â† ã“ã®+1ãŒå•é¡Œ
  }

  // ä¿®æ­£å¾Œ
  export function convertToDisplayColumn(line: string, charIndex: number, tabWidth = 8): number {
    if (charIndex <= 0) {
      return 1;
    }
    const substring = line.slice(0, charIndex);
    return getDisplayWidth(substring, tabWidth);  // +1ã‚’å‰Šé™¤
  }
  ```

- [x] **ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã®è¿½åŠ **
  - [x] æ–‡é ­ãƒ’ãƒ³ãƒˆä½ç½®ã®æ­£ç¢ºæ€§ãƒ†ã‚¹ãƒˆ
  - [x] 1ãƒ™ãƒ¼ã‚¹/0ãƒ™ãƒ¼ã‚¹ã®å¤‰æ›ãƒ†ã‚¹ãƒˆ
  - [x] ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ã®ãƒ†ã‚¹ãƒˆ

##### å½±éŸ¿ç¯„å›²ã®ç¢ºèª
- [x] Wordç”Ÿæˆç®‡æ‰€ã®ç¢ºèª
- [x] ä»–ã®åˆ—ä½ç½®è¨ˆç®—ç®‡æ‰€ã¸ã®å½±éŸ¿èª¿æŸ»
- [x] æ—¢å­˜ãƒ†ã‚¹ãƒˆã®ä¿®æ­£ãŒå¿…è¦ã‹ç¢ºèª

### process2.6 Word.colç”Ÿæˆæ™‚ã®è¡¨ç¤ºå¹…å¤‰æ›ã€ç·Šæ€¥ä¿®æ­£ã€‘
#### sub1 detector.tsã®Wordç”Ÿæˆå‡¦ç†ä¿®æ­£
@target: denops/hellshake-yano/word/detector.ts
@ref: denops/hellshake-yano/hint-utils.tsï¼ˆconvertToDisplayColumné–¢æ•°ï¼‰

##### ä¿®æ­£å†…å®¹
- [x] **Wordç”Ÿæˆæ™‚ã®åˆ—ä½ç½®è¨ˆç®—ã‚’è¡¨ç¤ºå¹…ãƒ™ãƒ¼ã‚¹ã«å¤‰æ›´**
  ```typescript
  // ä¿®æ­£å‰ï¼ˆ382è¡Œç›®ã€422è¡Œç›®ãªã©ï¼‰
  col: match.index + 1,  // æ–‡å­—ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãƒ™ãƒ¼ã‚¹

  // ä¿®æ­£å¾Œ
  col: convertToDisplayColumn(line, match.index, tabWidth),
  ```

- [x] **å½±éŸ¿ç®‡æ‰€ã®ç¢ºèª**
  - [x] å…¨ã¦ã®Wordç”Ÿæˆç®‡æ‰€ã‚’ç¢ºèªï¼ˆå°‘ãªãã¨ã‚‚2ç®‡æ‰€: 382è¡Œç›®ã€422è¡Œç›®ï¼‰
  - [x] tabWidth ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®è¿½åŠ ãŒå¿…è¦ã‹ç¢ºèª
  - [x] æ—¢å­˜ã®Word.colåˆ©ç”¨ç®‡æ‰€ã¸ã®å½±éŸ¿èª¿æŸ»

##### ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹
- [x] ã‚¿ãƒ–æ–‡å­—ãªã—ã§ã®è¨˜å·ãƒ»æ–‡å­—å¢ƒç•Œãƒ†ã‚¹ãƒˆ
  - [x] ã€Œâ–¡ è¨˜å·vsæ–‡å­—ã®ã€ã®ãƒ‘ã‚¿ãƒ¼ãƒ³
  - [x] å…¨è§’è¨˜å·ã€Œâ‘£ã€ã¨åŠè§’è‹±å­—ã€Œsubã€ã®çµ„ã¿åˆã‚ã›
- [x] ã‚¿ãƒ–æ–‡å­—ã‚ã‚Šã§ã®è¨˜å·ãƒ»æ–‡å­—å¢ƒç•Œãƒ†ã‚¹ãƒˆ
  - [x] ã€Œ\tâ–¡ è¨˜å·vsæ–‡å­—ã®ã€ã®ãƒ‘ã‚¿ãƒ¼ãƒ³
- [x] å…¨è§’è¨˜å·ã¨åŠè§’æ–‡å­—ã®çµ„ã¿åˆã‚ã›ãƒ†ã‚¹ãƒˆ
  - [x] ä¸¸æ•°å­—ã€Œâ‘ â‘¡â‘¢â‘£â‘¤ã€ã¨è‹±å­—ã®éš£æ¥
- [x] è¤‡æ•°ã®ã‚¿ãƒ–æ–‡å­—ã‚’å«ã‚€è¡Œã®ãƒ†ã‚¹ãƒˆ
  - [x] ã€Œ\t\tæ–‡å­—ã€ã®ã‚ˆã†ãªè¤‡æ•°ã‚¿ãƒ–ã®ã‚±ãƒ¼ã‚¹

##### å®Ÿè£…ã®æ³¨æ„ç‚¹
- [x] convertToDisplayColumné–¢æ•°ã¯process2.5ã§+1ã‚’å‰Šé™¤æ¸ˆã¿
- [x] Wordå‹ã®å®šç¾©ã§ã¯`col`ã¯ã€Œ1ãƒ™ãƒ¼ã‚¹ã€è¡¨ç¤ºåˆ—ä½ç½®ã€ã¨ã—ã¦å®šç¾©
- [x] ä¸€è²«æ€§ã‚’ä¿ã¤ãŸã‚ã€å…¨ã¦ã®Wordç”Ÿæˆç®‡æ‰€ã§åŒã˜å¤‰æ›ã‚’é©ç”¨

### process3 è¨˜å·å¯¾å¿œã¨ãƒ’ãƒ³ãƒˆå„ªå…ˆé †ä½ã€TDD Red-Green-Refactorã€‘
#### sub1 è¨˜å·ã®è¡¨ç¤ºå¹…å¯¾å¿œã¨å„ªå…ˆé †ä½å®Ÿè£…
@target: denops/hellshake-yano/utils/display.ts
@target: denops/hellshake-yano/hint.ts
@test: denops/hellshake-yano/hint.test.tsï¼ˆæ—¢å­˜ã‚’æ‹¡å¼µï¼‰

##### ğŸ”´ Red Phase: ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆï¼ˆè¨˜å·å¯¾å¿œãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ï¼‰
- [x] **è¨˜å·ã®è¡¨ç¤ºå¹…ãƒ†ã‚¹ãƒˆï¼ˆ8ã‚±ãƒ¼ã‚¹ï¼‰**
  - [x] ä¸¸æ•°å­—ã€Œâ‘ â‘¡â‘¢â‘£â‘¤ã€â†’ å„2å¹…
  - [x] æ‹¬å¼§ä»˜ãæ•°å­—ã€Œâ‘´â‘µâ‘¶ã€â†’ å„2å¹…
  - [x] çŸ¢å°è¨˜å·ã€Œâ†’â†â†‘â†“ã€â†’ å„2å¹…
  - [x] æ•°å­¦è¨˜å·ã€Œï¼‹ï¼Ã—Ã·ã€â†’ å„2å¹…
  - [x] åŠè§’è¨˜å·ã€Œ+-*/ã€â†’
  - [x] æ··åˆã€Œâ‘ sub2ã€â†’ 2+3+3+3+1 = 12å¹…
  - [x] ã‚¹ãƒšãƒ¼ã‚¹åˆ¶ç´„ã€Œâ‘£sã€â†’ éš£æ¥åˆ¤å®š
  - [x] å„ªå…ˆé †ä½ã€Œâ‘£subã€â†’ subã®ãƒ’ãƒ³ãƒˆå„ªå…ˆ

- [x] **ç‹­ã‚¹ãƒšãƒ¼ã‚¹ã§ã®ãƒ’ãƒ³ãƒˆè¡¨ç¤ºåˆ¤å®šãƒ†ã‚¹ãƒˆï¼ˆ6ã‚±ãƒ¼ã‚¹ï¼‰**
  - [x] æœ€å°å¹…æœªæº€ã§ã®ãƒ’ãƒ³ãƒˆéè¡¨ç¤º
  - [x] ç‰‡æ–¹ã®ã¿è¡¨ç¤ºå¯èƒ½ãªå ´åˆ
  - [x] ä¸¡æ–¹è¡¨ç¤ºå¯èƒ½ãªå ´åˆ
  - [x] è¨˜å·vsæ–‡å­—ã®å„ªå…ˆé †ä½
  - [x] è¨˜å·vsè¨˜å·ã®å ´åˆ
  - [x] æ–‡å­—vsæ–‡å­—ã®å ´åˆ

- [x] **å„ªå…ˆé †ä½ä»˜ããƒ’ãƒ³ãƒˆè¡¨ç¤ºãƒ†ã‚¹ãƒˆï¼ˆ5ã‚±ãƒ¼ã‚¹ï¼‰**
  - [x] è¨˜å·ã‚ˆã‚Šæ–‡å­—ã‚’å„ªå…ˆ
  - [x] åŒã˜å„ªå…ˆåº¦ã®å ´åˆã¯å·¦ã‚’å„ªå…ˆ
  - [x] 3ã¤ä»¥ä¸Šéš£æ¥ã™ã‚‹å ´åˆ
  - [x] è¡Œé ­ãƒ»è¡Œæœ«ã§ã®å„ªå…ˆé †ä½
  - [x] è¤‡æ•°è¡Œã§ã®å„ªå…ˆé †ä½

##### ğŸŸ¢ Green Phase: æœ€å°é™ã®å®Ÿè£…ï¼ˆ3æ®µéšï¼‰
- [x] **Stage 1: è¨˜å·ã®è¡¨ç¤ºå¹…è¨ˆç®—æ”¹å–„**
  - [x] å…¨è§’è¨˜å·åˆ¤å®šé–¢æ•°ã®ä½œæˆ
    ```typescript
    function isFullWidthSymbol(codePoint: number): boolean {
      // ä¸¸æ•°å­—ã€æ‹¬å¼§ä»˜ãæ•°å­—ã€çŸ¢å°ã€æ•°å­¦è¨˜å·ç­‰
      return (
        (codePoint >= 0x2460 && codePoint <= 0x24FF) || // å›²ã¿è‹±æ•°å­—
        (codePoint >= 0x2500 && codePoint <= 0x257F) || // ç½«ç·šç´ 
        (codePoint >= 0x2580 && codePoint <= 0x259F) || // ãƒ–ãƒ­ãƒƒã‚¯è¦ç´ 
        // ä»–ã®å…¨è§’è¨˜å·ç¯„å›²...
      );
    }
    ```
  - [x] getCharDisplayWidthé–¢æ•°ã®è¨˜å·å¯¾å¿œå¼·åŒ–

- [x] **Stage 2: ãƒ’ãƒ³ãƒˆè¡¨ç¤ºå¯èƒ½ã‚¹ãƒšãƒ¼ã‚¹åˆ¤å®š**
  - [x] `canDisplayHint`é–¢æ•°ã®ä½œæˆ
    ```typescript
    function canDisplayHint(
      word: Word,
      adjacentWords: Word[],
      minHintWidth: number = 2
    ): boolean {
      // åˆ©ç”¨å¯èƒ½ã‚¹ãƒšãƒ¼ã‚¹ã®è¨ˆç®—
      // éš£æ¥å˜èªã¨ã®è·é›¢ãƒã‚§ãƒƒã‚¯
    }
    ```
  - [x] æœ€å°è¡¨ç¤ºå¹…ã®å®šç¾©ï¼ˆè¨­å®šå¯èƒ½ã«ï¼‰

- [x] **Stage 3: å„ªå…ˆé †ä½ä»˜ããƒ’ãƒ³ãƒˆè¡¨ç¤º**
  - [x] `prioritizeHints`é–¢æ•°ã®ä½œæˆ
    ```typescript
    function prioritizeHints(words: Word[]): Word[] {
      // 1. æ–‡å­— > è¨˜å·
      // 2. é•·ã„å˜èª > çŸ­ã„å˜èª
      // 3. å·¦ > å³
    }
    ```
  - [x] shouldSkipHintForOverlapé–¢æ•°ã®æ”¹å–„

##### ğŸ”µ Refactor Phase: æœ€é©åŒ–ã¨æ”¹å–„
- [ ] **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–**
  - [ ] è¨˜å·åˆ¤å®šã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥åŒ–
  - [ ] å„ªå…ˆé †ä½è¨ˆç®—ã®åŠ¹ç‡åŒ–

- [ ] **è¨­å®šã‚ªãƒ—ã‚·ãƒ§ãƒ³è¿½åŠ **
  - [ ] æœ€å°ãƒ’ãƒ³ãƒˆå¹…ã®è¨­å®š
  - [ ] å„ªå…ˆé †ä½ãƒ«ãƒ¼ãƒ«ã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º
  - [ ] è¨˜å·ãƒ’ãƒ³ãƒˆè¡¨ç¤ºã®æœ‰åŠ¹/ç„¡åŠ¹

#### sub2 Configå‹ã®æ‹¡å¼µ
@target: denops/hellshake-yano/config.ts
- [ ] `use_display_width`è¨­å®šã®è¿½åŠ 
  - ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: true
  - è¡¨ç¤ºå¹…è¨ˆç®—ã‚’æœ‰åŠ¹/ç„¡åŠ¹åŒ–
- [ ] `tab_width`è¨­å®šã®è¿½åŠ 
  - ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: Vimã®è¨­å®šå€¤ã‚’ä½¿ç”¨
  - æ˜ç¤ºçš„ãªã‚¿ãƒ–å¹…ã®æŒ‡å®š

### process4 TinySegmenteræ”¹å–„ã€æ®µéšçš„å®Ÿè£…ã€‘
#### èƒŒæ™¯ã¨å•é¡Œç‚¹
@problem: TinySegmenterã«ã‚ˆã‚‹æ—¥æœ¬èªåˆ†å‰²ãŒéåº¦ã«ç´°åˆ†åŒ–ã•ã‚Œã€æ„å›³é€šã‚Šã«ãƒ’ãƒ³ãƒˆãŒè¡¨ç¤ºã•ã‚Œãªã„
@impact: è¤‡åˆèªã€å°‚é–€ç”¨èªã€åŠ©è©ã®å‡¦ç†ã§ä¸è‡ªç„¶ãªåˆ†å‰²ãŒç™ºç”Ÿ

##### ç¾çŠ¶ã®å•é¡Œç‚¹
1. **éåº¦ãªåˆ†å‰²**: è¤‡åˆèªã‚„å›ºæœ‰åè©ãŒç´°ã‹ãåˆ†å‰²ã•ã‚Œã™ãã‚‹
2. **åŠ©è©ãƒ»æ¥ç¶šè©ã®å‡¦ç†**: é™å®šçš„ãªãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒãƒ³ã‚°ã§å¯¾å¿œ
3. **å°‚é–€ç”¨èªã®èªè­˜ä¸è¶³**: ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ç”¨èªã‚„æ¥­ç•Œç”¨èªãŒæ­£ã—ãèªè­˜ã•ã‚Œãªã„
4. **æ–‡è„ˆè€ƒæ…®ã®æ¬ å¦‚**: å˜ç´”ãªå½¢æ…‹ç´ è§£æã®ãŸã‚ã€æ–‡è„ˆã«å¿œã˜ãŸåˆ†å‰²ãŒã§ããªã„

#### sub1 è¾æ›¸ãƒ™ãƒ¼ã‚¹ã®è£œæ­£ã‚·ã‚¹ãƒ†ãƒ ã€å„ªå…ˆåº¦: é«˜ã€‘
@target: denops/hellshake-yano/word/dictionary.tsï¼ˆæ–°è¦ä½œæˆï¼‰
@test: denops/hellshake-yano/word/dictionary.test.tsï¼ˆæ–°è¦ä½œæˆï¼‰
@ref: denops/hellshake-yano/word/detector.tsï¼ˆTinySegmenterWordDetectorï¼‰

##### ğŸ”´ Red Phase: ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆ
- [x] **è¾æ›¸æ©Ÿèƒ½ã®åŸºæœ¬ãƒ†ã‚¹ãƒˆï¼ˆ10ã‚±ãƒ¼ã‚¹ï¼‰**
  - [x] ã‚«ã‚¹ã‚¿ãƒ å˜èªã®ç™»éŒ²ã¨æ¤œç´¢
  - [x] è¤‡åˆèªãƒ‘ã‚¿ãƒ¼ãƒ³ã®ãƒãƒƒãƒãƒ³ã‚°
  - [x] åˆ†å‰²ç¦æ­¢ãƒ¯ãƒ¼ãƒ‰ã®è­˜åˆ¥
  - [x] çµåˆãƒ«ãƒ¼ãƒ«ã®é©ç”¨
  - [x] å„ªå…ˆåº¦ã«ã‚ˆã‚‹ç«¶åˆè§£æ±º
  - [x] è¾æ›¸ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿
  - [x] ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå›ºæœ‰è¾æ›¸ã®çµ±åˆ
  - [x] ãƒ“ãƒ«ãƒˆã‚¤ãƒ³è¾æ›¸ã®åˆ©ç”¨
  - [x] è¾æ›¸ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½
  - [x] å‹•çš„è¾æ›¸æ›´æ–°

- [x] **æ—¥æœ¬èªãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ç”¨èªãƒ†ã‚¹ãƒˆï¼ˆ8ã‚±ãƒ¼ã‚¹ï¼‰**
  - [x] ã€Œé–¢æ•°å®šç¾©ã€â†’ ãã®ã¾ã¾ä¿æŒ
  - [x] ã€ŒéåŒæœŸå‡¦ç†ã€â†’ ãã®ã¾ã¾ä¿æŒ
  - [x] ã€Œé…åˆ—æ“ä½œã€â†’ ãã®ã¾ã¾ä¿æŒ
  - [x] ã€Œã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæŒ‡å‘ã€â†’ ãã®ã¾ã¾ä¿æŒ
  - [x] ã€Œãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šã€â†’ ãã®ã¾ã¾ä¿æŒ
  - [x] ã€Œãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã€â†’ ãã®ã¾ã¾ä¿æŒ
  - [x] ã€Œãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ã€â†’ ãã®ã¾ã¾ä¿æŒ
  - [x] ã€Œãƒ‡ãƒãƒƒã‚°å®Ÿè¡Œã€â†’ ãã®ã¾ã¾ä¿æŒ

##### ğŸŸ¢ Green Phase: å®Ÿè£…
- [x] **Stage 1: è¾æ›¸ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å®šç¾©**
  ```typescript
  interface WordDictionary {
    customWords: Set<string>;
    compoundPatterns: RegExp[];
    preserveWords: Set<string>;
    mergeRules: Map<string, number>;
  }

  interface DictionaryConfig {
    dictionaryPath?: string;
    projectDictionaryPath?: string;
    useBuiltinDictionary?: boolean;
    enableLearning?: boolean;
  }
  ```

- [x] **Stage 2: ãƒ“ãƒ«ãƒˆã‚¤ãƒ³è¾æ›¸ã®å®Ÿè£…**
  - [x] æ—¥æœ¬èªãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ç”¨èªè¾æ›¸
  - [x] é »å‡ºè¤‡åˆèªãƒªã‚¹ãƒˆ
  - [x] åŠ©è©ãƒ»æ¥ç¶šè©ã®çµåˆãƒ«ãƒ¼ãƒ«

- [x] **Stage 3: TinySegmenterWordDetectorã¸ã®çµ±åˆ**
  - [x] `applyDictionaryCorrection`ãƒ¡ã‚½ãƒƒãƒ‰ã®è¿½åŠ 
  - [x] `segmentsToWords`å‰ã«è¾æ›¸è£œæ­£ã‚’é©ç”¨
  - [x] è¾æ›¸ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®å®Ÿè£…

##### ğŸ”µ Refactor Phase: æœ€é©åŒ–
- [ ] è¾æ›¸æ¤œç´¢ã®é«˜é€ŸåŒ–ï¼ˆTrieæ§‹é€ ãªã©ï¼‰
- [ ] ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ã®æœ€é©åŒ–
- [ ] è¾æ›¸ã®é…å»¶èª­ã¿è¾¼ã¿

#### sub1.5 ãƒ¦ãƒ¼ã‚¶ãƒ¼å®šç¾©è¾æ›¸æ©Ÿèƒ½ã€å„ªå…ˆåº¦: é«˜ã€‘
@target: denops/hellshake-yano/word/dictionary-loader.tsï¼ˆæ–°è¦ä½œæˆï¼‰
@test: denops/hellshake-yano/word/dictionary-loader.test.tsï¼ˆæ–°è¦ä½œæˆï¼‰
@ref: denops/hellshake-yano/word/dictionary.tsï¼ˆæ—¢å­˜ã®è¾æ›¸ã‚·ã‚¹ãƒ†ãƒ ï¼‰

##### ğŸ”´ Red Phase: ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆ
- [x] **è¾æ›¸ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆï¼ˆ12ã‚±ãƒ¼ã‚¹ï¼‰**
  - [x] JSONå½¢å¼ã®è¾æ›¸ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿
  - [x] YAMLå½¢å¼ã®è¾æ›¸ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿
  - [x] ãƒ†ã‚­ã‚¹ãƒˆå½¢å¼ã®è¾æ›¸ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿
  - [x] ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¾æ›¸ã®æ¤œç´¢ã¨èª­ã¿è¾¼ã¿
  - [x] ã‚°ãƒ­ãƒ¼ãƒãƒ«è¾æ›¸ã®æ¤œç´¢ã¨èª­ã¿è¾¼ã¿
  - [x] å­˜åœ¨ã—ãªã„ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
  - [x] ä¸æ­£ãªå½¢å¼ã®ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
  - [x] ç©ºã®è¾æ›¸ãƒ•ã‚¡ã‚¤ãƒ«ã®å‡¦ç†
  - [x] è¾æ›¸ã®å„ªå…ˆé †ä½å‡¦ç†
  - [x] è¤‡æ•°è¾æ›¸ã®ãƒãƒ¼ã‚¸
  - [x] å¾ªç’°å‚ç…§ã®æ¤œå‡º
  - [x] å¤§å®¹é‡ãƒ•ã‚¡ã‚¤ãƒ«ã®å‡¦ç†

- [x] **è¾æ›¸ãƒãƒ¼ã‚¸ãƒ†ã‚¹ãƒˆï¼ˆ8ã‚±ãƒ¼ã‚¹ï¼‰**
  - [x] ãƒ“ãƒ«ãƒˆã‚¤ãƒ³è¾æ›¸ã¨ã®çµ±åˆ
  - [x] overrideæˆ¦ç•¥ã§ã®ãƒãƒ¼ã‚¸
  - [x] mergeæˆ¦ç•¥ã§ã®ãƒãƒ¼ã‚¸
  - [x] é‡è¤‡å˜èªã®å‡¦ç†
  - [x] ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ç«¶åˆè§£æ±º
  - [x] çµåˆãƒ«ãƒ¼ãƒ«ã®å„ªå…ˆé †ä½
  - [x] ã‚«ã‚¹ã‚¿ãƒ å˜èªã®è¿½åŠ 
  - [x] åˆ†å‰²ç¦æ­¢ãƒ¯ãƒ¼ãƒ‰ã®çµ±åˆ

- [x] **Vimé€£æºãƒ†ã‚¹ãƒˆï¼ˆ6ã‚±ãƒ¼ã‚¹ï¼‰**
  - [x] è¨­å®šå€¤ã®èª­ã¿å–ã‚Š
  - [x] è¾æ›¸ãƒ‘ã‚¹ã®è§£æ±º
  - [x] å‹•çš„å†èª­ã¿è¾¼ã¿
  - [x] ã‚¨ãƒ©ãƒ¼é€šçŸ¥
  - [x] ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã®é©ç”¨
  - [x] ç’°å¢ƒå¤‰æ•°ã®å±•é–‹

- [x] **ãƒ’ãƒ³ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³ãƒ†ã‚¹ãƒˆï¼ˆ10ã‚±ãƒ¼ã‚¹ï¼‰**
  - [x] æ­£è¦è¡¨ç¾ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒãƒ³ã‚°
  - [x] ã‚­ãƒ£ãƒ—ãƒãƒ£ã‚°ãƒ«ãƒ¼ãƒ—ã®æŠ½å‡º
  - [x] ãƒ’ãƒ³ãƒˆå„ªå…ˆåº¦ã®è¨­å®š
  - [x] ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆ`- [ ] ãƒ†ã‚­ã‚¹ãƒˆ`ï¼‰
  - [x] ç•ªå·ä»˜ããƒªã‚¹ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆ`1. ãƒ†ã‚­ã‚¹ãƒˆ`ï¼‰
  - [x] Markdownãƒ˜ãƒƒãƒ€ãƒ¼ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆ`## ãƒ†ã‚­ã‚¹ãƒˆ`ï¼‰
  - [x] æ—¥æœ¬èªæ‹¬å¼§ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆã€Œãƒ†ã‚­ã‚¹ãƒˆã€ï¼‰
  - [x] è¤‡æ•°ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ç«¶åˆè§£æ±º
  - [x] å„ªå…ˆåº¦ã«ã‚ˆã‚‹ä¸¦ã³æ›¿ãˆ
  - [x] éš£æ¥å˜èªã¨ã®èª¿æ•´

##### ğŸŸ¢ Green Phase: å®Ÿè£…
- [x] **Stage 1: è¾æ›¸ãƒ•ã‚¡ã‚¤ãƒ«ãƒ­ãƒ¼ãƒ€ãƒ¼**
  ```typescript
  class DictionaryLoader {
    private readonly searchPaths = [
      '.hellshake-yano/dictionary.json',
      'hellshake-yano.dict.json',
      '~/.config/hellshake-yano/dictionary.json'
    ];

    async loadUserDictionary(config?: DictionaryConfig): Promise<UserDictionary> {
      // ãƒ•ã‚¡ã‚¤ãƒ«æ¢ç´¢ã¨èª­ã¿è¾¼ã¿
    }

    private async parseJsonDictionary(content: string): Promise<UserDictionary>
    private async parseYamlDictionary(content: string): Promise<UserDictionary>
    private async parseTextDictionary(content: string): Promise<UserDictionary>
  }

  interface UserDictionary {
    customWords: string[];
    preserveWords: string[];
    mergeRules: Map<string, MergeStrategy>;
    compoundPatterns: RegExp[];
    hintPatterns?: HintPattern[];  // æ–°è¦è¿½åŠ 
    metadata?: {
      version?: string;
      author?: string;
      description?: string;
    };
  }

  interface HintPattern {
    pattern: string | RegExp;  // æ­£è¦è¡¨ç¾ãƒ‘ã‚¿ãƒ¼ãƒ³
    hintPosition: HintPositionRule;  // ãƒ’ãƒ³ãƒˆé…ç½®ãƒ«ãƒ¼ãƒ«
    priority: number;  // å„ªå…ˆåº¦ï¼ˆé«˜ã„ã»ã©å„ªå…ˆï¼‰
    description?: string;  // èª¬æ˜ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
  }

  type HintPositionRule =
    | 'capture:1' | 'capture:2' | 'capture:3'  // ã‚­ãƒ£ãƒ—ãƒãƒ£ã‚°ãƒ«ãƒ¼ãƒ—
    | 'start'  // ãƒãƒƒãƒã®é–‹å§‹ä½ç½®
    | 'end'    // ãƒãƒƒãƒã®çµ‚äº†ä½ç½®
    | { offset: number; from: 'start' | 'end' };  // ã‚«ã‚¹ã‚¿ãƒ ã‚ªãƒ•ã‚»ãƒƒãƒˆ
  ```

- [x] **Stage 2: è¾æ›¸ãƒãƒ¼ã‚¸æ©Ÿèƒ½**
  ```typescript
  class DictionaryMerger {
    merge(
      base: WordDictionary,
      user: UserDictionary,
      strategy: 'override' | 'merge' = 'merge'
    ): WordDictionary {
      // ãƒãƒ¼ã‚¸ãƒ­ã‚¸ãƒƒã‚¯ã®å®Ÿè£…
    }

    private mergeCustomWords(base: Set<string>, user: string[]): Set<string>
    private mergePatterns(base: RegExp[], user: RegExp[]): RegExp[]
    private resolvePriority(conflicts: ConflictItem[]): ResolvedItem[]
  }
  ```

- [x] **Stage 3: Vimè¨­å®šã¨ã®é€£æº**
  ```typescript
  interface VimDictionaryConfig {
    dictionaryPath?: string;         // g:hellshake_yano_dictionary_path
    useBuiltinDict?: boolean;        // g:hellshake_yano_use_builtin_dict
    mergingStrategy?: 'override' | 'merge'; // g:hellshake_yano_dictionary_merge
    autoReload?: boolean;            // g:hellshake_yano_auto_reload_dict
  }

  class VimConfigBridge {
    async getConfig(denops: Denops): Promise<VimDictionaryConfig>
    async notifyError(denops: Denops, error: string): Promise<void>
    async reloadDictionary(denops: Denops): Promise<void>
  }
  ```

- [x] **Stage 4: ãƒ’ãƒ³ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³å‡¦ç†ã‚¨ãƒ³ã‚¸ãƒ³**
  ```typescript
  class HintPatternProcessor {
    applyHintPatterns(words: Word[], text: string, patterns: HintPattern[]): Word[] {
      // ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒãƒ³ã‚°ã¨ãƒ’ãƒ³ãƒˆå„ªå…ˆåº¦è¨­å®š
    }

    private extractHintTarget(
      match: RegExpExecArray,
      rule: HintPositionRule
    ): { text: string; position: number } | null {
      // ã‚­ãƒ£ãƒ—ãƒãƒ£ã‚°ãƒ«ãƒ¼ãƒ—ã‚„ä½ç½®ãƒ«ãƒ¼ãƒ«ã®è§£æ
    }

    private findWordAtPosition(words: Word[], position: number): Word | null {
      // æŒ‡å®šä½ç½®ã®å˜èªã‚’æ¤œç´¢
    }

    private sortByHintPriority(words: Word[]): Word[] {
      // å„ªå…ˆåº¦ã«ã‚ˆã‚‹ä¸¦ã³æ›¿ãˆã¨éš£æ¥èª¿æ•´
    }
  }
  ```

- [x] **Stage 5: è¾æ›¸ç®¡ç†ã‚³ãƒãƒ³ãƒ‰**
  ```typescript
  // Vimã‚³ãƒãƒ³ãƒ‰ã®å®Ÿè£…
  export async function registerDictionaryCommands(denops: Denops) {
    await denops.cmd('command! HellshakeYanoReloadDict call denops#request("hellshake-yano", "reloadDictionary", [])')
    await denops.cmd('command! HellshakeYanoEditDict call denops#request("hellshake-yano", "editDictionary", [])')
    await denops.cmd('command! HellshakeYanoShowDict call denops#request("hellshake-yano", "showDictionary", [])')
    await denops.cmd('command! HellshakeYanoValidateDict call denops#request("hellshake-yano", "validateDictionary", [])')
  }
  ```

##### ğŸ”µ Refactor Phase: æœ€é©åŒ–
- [ ] **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–**
  - [ ] è¾æ›¸ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®å®Ÿè£…
  - [ ] ãƒ•ã‚¡ã‚¤ãƒ«å¤‰æ›´ç›£è¦–ï¼ˆãƒ›ãƒƒãƒˆãƒªãƒ­ãƒ¼ãƒ‰ï¼‰
  - [ ] é…å»¶èª­ã¿è¾¼ã¿æˆ¦ç•¥

- [ ] **ãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£å‘ä¸Š**
  - [ ] è¾æ›¸ãƒ•ã‚¡ã‚¤ãƒ«ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç”Ÿæˆ
  - [ ] è¾æ›¸æ¤œè¨¼ãƒ„ãƒ¼ãƒ«
  - [ ] ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ˜ãƒ«ãƒ‘ãƒ¼

- [ ] **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å¼·åŒ–**
  - [ ] è©³ç´°ãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
  - [ ] è¾æ›¸ãƒ•ã‚¡ã‚¤ãƒ«ã®è‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
  - [ ] å¾©æ—§æ©Ÿèƒ½

##### è¾æ›¸ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ã®ä»•æ§˜
- [x] **JSONå½¢å¼ä»•æ§˜**
  ```json
  {
    "$schema": "https://example.com/hellshake-yano-dict-schema.json",
    "version": "1.0",
    "customWords": ["æ©Ÿæ¢°å­¦ç¿’", "æ·±å±¤å­¦ç¿’"],
    "preserveWords": ["HelloWorld", "getElementById"],
    "mergeRules": {
      "ã®": "always",
      "ã‚’": "always"
    },
    "compoundPatterns": [".*Controller$", "^I[A-Z].*"],
    "hintPatterns": [
      {
        "pattern": "^-\\s*\\[\\s*\\]\\s*(.)",
        "hintPosition": "capture:1",
        "priority": 100,
        "description": "ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹å¾Œã®æœ€åˆã®æ–‡å­—"
      },
      {
        "pattern": "^\\d+\\.\\s*(.)",
        "hintPosition": "capture:1",
        "priority": 95,
        "description": "ç•ªå·ä»˜ããƒªã‚¹ãƒˆã®æœ€åˆã®æ–‡å­—"
      },
      {
        "pattern": "^(#+)\\s*(.)",
        "hintPosition": "capture:2",
        "priority": 90,
        "description": "Markdownãƒ˜ãƒƒãƒ€ãƒ¼ã®æœ€åˆã®æ–‡å­—"
      },
      {
        "pattern": "ã€Œ([^ã€])",
        "hintPosition": "capture:1",
        "priority": 80,
        "description": "æ‹¬å¼§å†…ã®æœ€åˆã®æ–‡å­—"
      }
    ]
  }
  ```

- [x] **YAMLå½¢å¼ä»•æ§˜**
  ```yaml
  version: "1.0"
  customWords:
    - æ©Ÿæ¢°å­¦ç¿’
    - æ·±å±¤å­¦ç¿’
  preserveWords:
    - HelloWorld
  mergeRules:
    ã®: always
    ã‚’: always
  hintPatterns:
    - pattern: "^-\\s*\\[\\s*\\]\\s*(.)"
      hintPosition: "capture:1"
      priority: 100
      description: "ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹å¾Œã®æœ€åˆã®æ–‡å­—"
    - pattern: "^\\d+\\.\\s*(.)"
      hintPosition: "capture:1"
      priority: 95
      description: "ç•ªå·ä»˜ããƒªã‚¹ãƒˆã®æœ€åˆã®æ–‡å­—"
  ```

- [x] **ãƒ†ã‚­ã‚¹ãƒˆå½¢å¼ä»•æ§˜**
  ```
  # ã‚«ã‚¹ã‚¿ãƒ å˜èªï¼ˆ#ã§ã‚³ãƒ¡ãƒ³ãƒˆï¼‰
  æ©Ÿæ¢°å­¦ç¿’
  æ·±å±¤å­¦ç¿’

  # åˆ†å‰²ç¦æ­¢ï¼ˆ!ã§é–‹å§‹ï¼‰
  !HelloWorld
  !getElementById

  # çµåˆãƒ«ãƒ¼ãƒ«ï¼ˆ=ã§å®šç¾©ï¼‰
  ã®=always
  ã‚’=always

  # ãƒ’ãƒ³ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆ@ã§å®šç¾©ã€å„ªå…ˆåº¦:ãƒ‘ã‚¿ãƒ¼ãƒ³:ä½ç½®ï¼‰
  @100:^-\s*\[\s*\]\s*(.)ï¼šcapture:1
  @95:^\d+\.\s*(.)ï¼šcapture:1
  @90:^#+\s*(.)ï¼šcapture:1
  @80:ã€Œ([^ã€])ï¼šcapture:1
  ```

##### ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³
- [x] **M1**: åŸºæœ¬çš„ãªè¾æ›¸ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿æ©Ÿèƒ½
- [x] **M2**: è¤‡æ•°å½¢å¼ã®ã‚µãƒãƒ¼ãƒˆå®Œäº†
- [x] **M3**: ãƒ’ãƒ³ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³å‡¦ç†ã‚¨ãƒ³ã‚¸ãƒ³ã®å®Ÿè£…
- [ ] **M4**: Vimé€£æºæ©Ÿèƒ½ã®å®Ÿè£…
- [ ] **M5**: è¾æ›¸ç®¡ç†ã‚³ãƒãƒ³ãƒ‰ã®å®Œæˆ
- [ ] **M6**: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¨ã‚µãƒ³ãƒ—ãƒ«è¾æ›¸ã®æä¾›

#### sub2 éš£æ¥æ–‡å­—è§£æã«ã‚ˆã‚‹è£œæ­£ã®å¼·åŒ–ã€å„ªå…ˆåº¦: é«˜ã€‘
@target: denops/hellshake-yano/utils/charType.tsï¼ˆæ–°è¦ä½œæˆï¼‰
@target: denops/hellshake-yano/utils/charType.test.tsï¼ˆæ–°è¦ä½œæˆï¼‰
@target: denops/hellshake-yano/word/detector.tsï¼ˆmergeShortSegmentsWithPositionæ‹¡å¼µï¼‰
@test: denops/hellshake-yano/word/detector.test.tsï¼ˆæ‹¡å¼µï¼‰

##### è¨­è¨ˆæ¦‚è¦
ç¾åœ¨ã®`mergeShortSegmentsWithPosition`ãƒ¡ã‚½ãƒƒãƒ‰ã®å•é¡Œç‚¹ã‚’è§£æ±ºï¼š
- åŠ©è©ãƒ»æ¥ç¶šè©ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒé™å®šçš„ï¼ˆå›ºå®šçš„ãªæ­£è¦è¡¨ç¾ï¼‰
- æ–‡å­—ç¨®ï¼ˆã²ã‚‰ãŒãªã€ã‚«ã‚¿ã‚«ãƒŠã€æ¼¢å­—ã€è‹±å­—ç­‰ï¼‰ã®å¢ƒç•Œã‚’è€ƒæ…®ã—ã¦ã„ãªã„
- æ‹¬å¼§ã‚„å¼•ç”¨ç¬¦å†…ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’ç‰¹åˆ¥æ‰±ã„ã—ã¦ã„ãªã„
- CamelCaseã€snake_caseç­‰ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°å‘½åè¦å‰‡ã«éå¯¾å¿œ

##### ğŸ”´ Red Phase: ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆ
- [x] **æ–‡å­—ç¨®åˆ¤å®šãƒ†ã‚¹ãƒˆï¼ˆcharType.test.ts - 15ã‚±ãƒ¼ã‚¹ï¼‰**
  - [x] ã²ã‚‰ãŒãªåˆ¤å®š: `getCharType('ã‚') === CharType.Hiragana`
  - [x] ã‚«ã‚¿ã‚«ãƒŠåˆ¤å®š: `getCharType('ã‚¢') === CharType.Katakana`
  - [x] æ¼¢å­—åˆ¤å®š: `getCharType('æ¼¢') === CharType.Kanji`
  - [x] è‹±å¤§æ–‡å­—åˆ¤å®š: `getCharType('A') === CharType.AlphaUpper`
  - [x] è‹±å°æ–‡å­—åˆ¤å®š: `getCharType('a') === CharType.AlphaLower`
  - [x] æ•°å­—åˆ¤å®š: `getCharType('1') === CharType.Number`
  - [x] è¨˜å·åˆ¤å®š: `getCharType('!') === CharType.Symbol`
  - [x] é–‹ãæ‹¬å¼§åˆ¤å®š: `getCharType('(') === CharType.BracketOpen`
  - [x] é–‰ã˜æ‹¬å¼§åˆ¤å®š: `getCharType(')') === CharType.BracketClose`
  - [x] å¼•ç”¨ç¬¦åˆ¤å®š: `getCharType('"') === CharType.Quote`
  - [x] ã‚¹ãƒšãƒ¼ã‚¹åˆ¤å®š: `getCharType(' ') === CharType.Space`
  - [x] æ··åˆæ–‡å­—åˆ—ã®è§£æ: `analyzeString('æ¼¢å­—ã¨English')`
  - [x] å¢ƒç•Œæ¤œå‡º: `findBoundaries('æ¼¢å­—English123')`
  - [x] å…¨è§’æ–‡å­—åˆ¤å®š: `isFullWidth('ã‚') === true`
  - [x] åŠè§’æ–‡å­—åˆ¤å®š: `isHalfWidth('a') === true`

- [x] **çµåˆåˆ¤å®šãƒ†ã‚¹ãƒˆï¼ˆdetector.test.tsæ‹¡å¼µ - 12ã‚±ãƒ¼ã‚¹ï¼‰**
  - [x] åŠ©è©ã®å‰å˜èªã¸ã®çµåˆ: `æ©Ÿèƒ½ã‚’` â†’ `[æ©Ÿèƒ½ã‚’]`
  - [x] æ¥ç¶šè©ã®å‡¦ç†: `ã—ã‹ã—` â†’ ç‹¬ç«‹ã‚»ã‚°ãƒ¡ãƒ³ãƒˆ
  - [x] æ–‡å­—ç¨®å¢ƒç•Œã§ã®åˆ†å‰²ç¶­æŒ: `æ—¥æœ¬èªEnglish` â†’ `[æ—¥æœ¬èª][English]`
  - [x] æ‹¬å¼§å†…ãƒ†ã‚­ã‚¹ãƒˆã®ä¿æŒ: `(é‡è¦ãªå†…å®¹)` â†’ `[(é‡è¦ãªå†…å®¹)]`
  - [x] å¼•ç”¨ç¬¦å†…ãƒ†ã‚­ã‚¹ãƒˆã®ä¿æŒ: `"quoted text"` â†’ `["quoted text"]`
  - [x] ã‚«ã‚¿ã‚«ãƒŠé€£ç¶šã®ä¿æŒ: `ã‚·ã‚¹ãƒ†ãƒ ã‚¨ãƒ©ãƒ¼` â†’ `[ã‚·ã‚¹ãƒ†ãƒ ã‚¨ãƒ©ãƒ¼]`
  - [x] è‹±æ•°å­—é€£ç¶šã®ä¿æŒ: `test123` â†’ `[test123]`
  - [x] æ¼¢å­—ï¼‹ã²ã‚‰ãŒãªãƒ‘ã‚¿ãƒ¼ãƒ³: `èµ°ã‚‹` â†’ `[èµ°ã‚‹]`
  - [x] è¨˜å·ã«ã‚ˆã‚‹å¢ƒç•Œèªè­˜: `word.method` â†’ `[word][.][method]`
  - [x] CamelCaseå‡¦ç†: `getUserName` â†’ `[get][User][Name]`
  - [x] snake_caseå‡¦ç†: `user_name` â†’ `[user_name]`
  - [x] kebab-caseå‡¦ç†: `user-name` â†’ `[user-name]`

##### ğŸŸ¢ Green Phase: å®Ÿè£…
- [x] **Stage 1: æ–‡å­—ç¨®åˆ¤å®šãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ (charType.ts)**
  ```typescript
  // æ–‡å­—ç¨®ã®å®šç¾©
  export enum CharType {
    Hiragana = 'hiragana',          // ã²ã‚‰ãŒãª
    Katakana = 'katakana',          // ã‚«ã‚¿ã‚«ãƒŠ
    Kanji = 'kanji',                // æ¼¢å­—
    AlphaUpper = 'alpha_upper',     // è‹±å¤§æ–‡å­—
    AlphaLower = 'alpha_lower',     // è‹±å°æ–‡å­—
    Number = 'number',              // æ•°å­—
    Symbol = 'symbol',              // è¨˜å·
    BracketOpen = 'bracket_open',   // é–‹ãæ‹¬å¼§
    BracketClose = 'bracket_close', // é–‰ã˜æ‹¬å¼§
    Quote = 'quote',                // å¼•ç”¨ç¬¦
    Space = 'space',                // ã‚¹ãƒšãƒ¼ã‚¹
    Unknown = 'unknown'             // ä¸æ˜
  }

  // æ–‡å­—ç¨®åˆ¤å®šé–¢æ•°
  export function getCharType(char: string): CharType {
    // Unicodeç¯„å›²ã§åˆ¤å®š
    const code = char.charCodeAt(0);
    // ã²ã‚‰ãŒãª: U+3040-U+309F
    // ã‚«ã‚¿ã‚«ãƒŠ: U+30A0-U+30FF
    // æ¼¢å­—: U+4E00-U+9FAF
    // å®Ÿè£…...
  }

  // éš£æ¥æ–‡å­—è§£æ
  export interface AdjacentAnalysis {
    prevCharType: CharType | null;
    currentCharType: CharType;
    nextCharType: CharType | null;
    shouldMergeWithPrev: boolean;
    shouldMergeWithNext: boolean;
    isInBrackets: boolean;
    isInQuotes: boolean;
  }

  // æ–‡å­—åˆ—å…¨ä½“ã®è§£æ
  export function analyzeString(text: string): AdjacentAnalysis[] {
    // å„æ–‡å­—ã®æ–‡å­—ç¨®ã¨éš£æ¥é–¢ä¿‚ã‚’è§£æ
  }

  // å¢ƒç•Œæ¤œå‡º
  export function findBoundaries(text: string): number[] {
    // æ–‡å­—ç¨®ã®å¤‰åŒ–ç‚¹ã‚’æ¤œå‡º
  }
  ```

- [x] **Stage 2: æ‹¡å¼µåŠ©è©ãƒ»æ¥ç¶šè©ãƒ‘ã‚¿ãƒ¼ãƒ³**
  ```typescript
  // åŒ…æ‹¬çš„ãªåŠ©è©ãƒªã‚¹ãƒˆ
  const PARTICLES = {
    æ ¼åŠ©è©: ['ã‚’', 'ã«', 'ã§', 'ã¨', 'ã¸', 'ã‹ã‚‰', 'ã‚ˆã‚Š', 'ã¾ã§'],
    å‰¯åŠ©è©: ['ã¯', 'ã‚‚', 'ã ã‘', 'ã°ã‹ã‚Š', 'ãªã©', 'ãªã‚Š', 'ã‚„ã‚‰'],
    æ¥ç¶šåŠ©è©: ['ã¦', 'ã§', 'ã°', 'ã¨', 'ã¦ã‚‚', 'ã‘ã‚Œã©', 'ãŒ', 'ã®ã«'],
    çµ‚åŠ©è©: ['ã‹', 'ãª', 'ã‚ˆ', 'ã­', 'ã‚', 'ã®', 'ã•'],
    æº–ä½“åŠ©è©: ['ã®', 'ã“ã¨']
  };

  // æ¥ç¶šè©ãƒªã‚¹ãƒˆ
  const CONJUNCTIONS = {
    é †æ¥: ['ã ã‹ã‚‰', 'ã—ãŸãŒã£ã¦', 'ã‚ˆã£ã¦', 'ã‚†ãˆã«'],
    é€†æ¥: ['ã—ã‹ã—', 'ã‘ã‚Œã©ã‚‚', 'ã ãŒ', 'ã¨ã“ã‚ãŒ'],
    ä¸¦åˆ—: ['ã¾ãŸ', 'ãŠã‚ˆã³', 'ãªã‚‰ã³ã«'],
    è£œè¶³: ['ã¤ã¾ã‚Š', 'ã™ãªã‚ã¡', 'ãŸã ã—', 'ã‚‚ã£ã¨ã‚‚'],
    è»¢æ›: ['ã¨ã“ã‚ã§', 'ã•ã¦', 'ã§ã¯', 'ãã‚Œã§ã¯']
  };

  // æ–‡æœ«è¡¨ç¾ãƒ‘ã‚¿ãƒ¼ãƒ³
  const SENTENCE_ENDINGS = [
    'ã§ã™', 'ã¾ã™', 'ã§ã—ãŸ', 'ã¾ã—ãŸ',
    'ã ã‚ã†', 'ã§ã—ã‚‡ã†', 'ã‹ã‚‚ã—ã‚Œãªã„'
  ];
  ```

- [x] **Stage 3: mergeShortSegmentsWithPositionæ”¹è‰¯**
  ```typescript
  private mergeShortSegmentsWithPosition(
    segments: PositionSegment[]
  ): PositionSegment[] {
    // 1. æ–‡å­—ç¨®è§£æã®å®Ÿè¡Œ
    const analyses = segments.map(seg => analyzeString(seg.text));

    // 2. æ‹¬å¼§ãƒ»å¼•ç”¨ç¬¦ã®ã‚¹ã‚³ãƒ¼ãƒ—æ¤œå‡º
    const scopes = detectScopes(segments);

    // 3. çµåˆåˆ¤å®šãƒ«ãƒ¼ãƒ«ã®é©ç”¨
    const mergedSegments = applyMergeRules(segments, analyses, scopes, {
      // æ–‡å­—ç¨®å¢ƒç•Œã§ã®åˆ†å‰²
      respectCharTypeBoundaries: true,
      // æ‹¬å¼§å†…ä¿æŒ
      preserveBracketContent: true,
      // å¼•ç”¨ç¬¦å†…ä¿æŒ
      preserveQuoteContent: true,
      // CamelCaseåˆ†å‰²
      splitCamelCase: this.config.split_camel_case ?? false,
      // åŠ©è©çµåˆ
      mergeParticles: this.config.japanese_merge_particles !== false
    });

    return mergedSegments;
  }
  ```

- [ ] **Stage 4: Configæ‹¡å¼µ**
  ```typescript
  // types.ts ã®Config interfaceã«è¿½åŠ 
  export interface Config {
    // ... æ—¢å­˜ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ ...

    // === æ–‡å­—ç¨®è§£æè¨­å®š ===
    /** CamelCaseã‚’åˆ†å‰²ã™ã‚‹ã‹ */
    split_camel_case?: boolean;
    /** snake_caseã‚’ä¿æŒã™ã‚‹ã‹ */
    preserve_snake_case?: boolean;
    /** æ‹¬å¼§å†…ãƒ†ã‚­ã‚¹ãƒˆã‚’ä¿æŒã™ã‚‹ã‹ */
    preserve_bracket_content?: boolean;
    /** å¼•ç”¨ç¬¦å†…ãƒ†ã‚­ã‚¹ãƒˆã‚’ä¿æŒã™ã‚‹ã‹ */
    preserve_quote_content?: boolean;
    /** æ–‡å­—ç¨®å¢ƒç•Œã§åˆ†å‰²ã™ã‚‹ã‹ */
    respect_char_type_boundaries?: boolean;
    /** ã‚«ã‚¹ã‚¿ãƒ åŠ©è©ãƒªã‚¹ãƒˆ */
    custom_particles?: string[];
    /** ã‚«ã‚¹ã‚¿ãƒ æ¥ç¶šè©ãƒªã‚¹ãƒˆ */
    custom_conjunctions?: string[];
  }
  ```

##### ğŸ”µ Refactor Phase: æœ€é©åŒ–
- [x] **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–**
  - [x] æ–‡å­—ç¨®åˆ¤å®šã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼ˆLRU Cacheï¼‰
  - [x] Unicodeç¯„å›²ãƒã‚§ãƒƒã‚¯ã®æœ€é©åŒ–ï¼ˆãƒ“ãƒƒãƒˆãƒã‚¹ã‚¯ä½¿ç”¨ï¼‰
  - [x] æ­£è¦è¡¨ç¾ã®ãƒ—ãƒªã‚³ãƒ³ãƒ‘ã‚¤ãƒ«

- [x] **ãƒ¡ãƒ¢ãƒªæœ€é©åŒ–**
  - [x] æ–‡å­—åˆ—ã®ä½¿ã„å›ã—ï¼ˆstring interningï¼‰
  - [x] ä¸è¦ãªä¸­é–“é…åˆ—ã®å‰Šæ¸›

- [x] **è¨­å®šã®å¤–éƒ¨åŒ–**
  - [x] åŠ©è©ãƒ»æ¥ç¶šè©ãƒªã‚¹ãƒˆã®JSONåŒ–
  - [x] ãƒ¦ãƒ¼ã‚¶ãƒ¼å®šç¾©ãƒ«ãƒ¼ãƒ«ã®ã‚µãƒãƒ¼ãƒˆ
  - [x] è¨€èªåˆ¥è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®åˆ†é›¢

##### ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³
- [x] **M1**: æ–‡å­—ç¨®åˆ¤å®šãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã®å®Œæˆ
- [x] **M2**: æ‹¡å¼µåŠ©è©ãƒ»æ¥ç¶šè©ãƒ‘ã‚¿ãƒ¼ãƒ³ã®å®Ÿè£…
- [x] **M3**: mergeShortSegmentsWithPositionæ”¹è‰¯ã®å®Œæˆ
- [x] **M4**: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆã¨æœ€é©åŒ–
- [x] **M5**: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¨ã‚µãƒ³ãƒ—ãƒ«ã®ä½œæˆ

#### sub3 ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆèªè­˜ã«ã‚ˆã‚‹åˆ†å‰²èª¿æ•´ã€å„ªå…ˆåº¦: ä¸­ã€‘
@target: denops/hellshake-yano/types.tsï¼ˆDetectionContextæ‹¡å¼µï¼‰
@target: denops/hellshake-yano/word/context.tsï¼ˆæ–°è¦ä½œæˆï¼‰
@target: denops/hellshake-yano/word/context.test.tsï¼ˆæ–°è¦ä½œæˆï¼‰
@integration: denops/hellshake-yano/word/detector.tsï¼ˆã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆçµ±åˆï¼‰

##### è¨­è¨ˆæ¦‚è¦
ç¾åœ¨ã®DetectionContextã®å•é¡Œç‚¹ã‚’è§£æ±ºï¼š
- ãƒ•ã‚¡ã‚¤ãƒ«ã‚¿ã‚¤ãƒ—æƒ…å ±ãŒå«ã¾ã‚Œã¦ã„ãªã„
- æ§‹æ–‡ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆï¼ˆã‚³ãƒ¡ãƒ³ãƒˆã€æ–‡å­—åˆ—ç­‰ï¼‰ãŒè€ƒæ…®ã•ã‚Œã¦ã„ãªã„
- è¨€èªå›ºæœ‰ã®å‘½åè¦å‰‡ï¼ˆCamelCaseã€snake_caseç­‰ï¼‰ã«éå¯¾å¿œ
- ã™ã¹ã¦ã®ãƒ•ã‚¡ã‚¤ãƒ«ã§åŒã˜åˆ†å‰²ãƒ«ãƒ¼ãƒ«ãŒé©ç”¨ã•ã‚Œã‚‹

##### ğŸ”´ Red Phase: ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆ
- [ ] **ãƒ•ã‚¡ã‚¤ãƒ«ã‚¿ã‚¤ãƒ—åˆ¥åˆ†å‰²ãƒ†ã‚¹ãƒˆï¼ˆcontext.test.ts - 8ã‚±ãƒ¼ã‚¹ï¼‰**
  - [ ] TypeScript: `import { Component } from '@angular/core'` â†’ é©åˆ‡ãªåˆ†å‰²
  - [ ] JavaScript: `const getUserName = (id) => users[id]` â†’ é–¢æ•°åã¨å¤‰æ•°ã‚’èªè­˜
  - [ ] Python: `def get_user_name(user_id):` â†’ snake_caseã‚’ä¿æŒ
  - [ ] Markdown: `# è¦‹å‡ºã— [ãƒªãƒ³ã‚¯](url)` â†’ æ§‹é€ è¦ç´ ã‚’èªè­˜
  - [ ] JSON: `"propertyName": "value"` â†’ ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£åã‚’ä¿æŒ
  - [ ] YAML: `key: value # comment` â†’ ã‚³ãƒ¡ãƒ³ãƒˆã‚’åˆ†é›¢
  - [ ] HTML: `<div class="container">` â†’ ã‚¿ã‚°ã¨å±æ€§ã‚’èªè­˜
  - [ ] ãƒ—ãƒ¬ãƒ¼ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ: é€šå¸¸ã®æ—¥æœ¬èªæ–‡æ›¸ â†’ æ¨™æº–åˆ†å‰²

- [ ] **æ–‡è„ˆèªè­˜ãƒ†ã‚¹ãƒˆï¼ˆcontext.test.ts - 10ã‚±ãƒ¼ã‚¹ï¼‰**
  - [ ] ã‚³ãƒ¡ãƒ³ãƒˆå†…: `// ã“ã‚Œã¯ã‚³ãƒ¡ãƒ³ãƒˆã§ã™` â†’ ã‚³ãƒ¡ãƒ³ãƒˆã¨ã—ã¦èªè­˜
  - [ ] æ–‡å­—åˆ—ãƒªãƒ†ãƒ©ãƒ«å†…: `"Hello World"` â†’ æ–‡å­—åˆ—ã¨ã—ã¦ä¿æŒ
  - [ ] é–¢æ•°å: `getUserName` â†’ é–¢æ•°ã¨ã—ã¦èªè­˜
  - [ ] å¤‰æ•°å: `userName` â†’ å¤‰æ•°ã¨ã—ã¦èªè­˜
  - [ ] ã‚¯ãƒ©ã‚¹å: `UserManager` â†’ ã‚¯ãƒ©ã‚¹ã¨ã—ã¦èªè­˜
  - [ ] importæ–‡: `import { Component }` â†’ importæ§‹æ–‡ã¨ã—ã¦å‡¦ç†
  - [ ] CamelCase: `getUserName` â†’ `[get][User][Name]`ï¼ˆè¨­å®šã«ã‚ˆã‚‹ï¼‰
  - [ ] snake_case: `user_name` â†’ ãã®ã¾ã¾ä¿æŒ
  - [ ] kebab-case: `user-name` â†’ ãã®ã¾ã¾ä¿æŒ
  - [ ] ã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆãƒ¬ãƒ™ãƒ«: æ·±ã•0/2/4/8ã§ã®é‡è¦åº¦å¤‰åŒ–

##### ğŸŸ¢ Green Phase: å®Ÿè£…
- [ ] **Stage 1: DetectionContextæ‹¡å¼µ (types.ts)**
  ```typescript
  export interface DetectionContext {
    currentKey?: string;
    minWordLength?: number;
    metadata?: Record<string, unknown>;

    // æ–°è¦è¿½åŠ ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
    fileType?: string;           // Vimã®filetypeï¼ˆ'typescript', 'python'ç­‰ï¼‰
    syntaxContext?: SyntaxContext;
    lineContext?: LineContext;
  }

  export interface SyntaxContext {
    inComment: boolean;         // ã‚³ãƒ¡ãƒ³ãƒˆå†…ã‹
    inString: boolean;          // æ–‡å­—åˆ—ãƒªãƒ†ãƒ©ãƒ«å†…ã‹
    inFunction: boolean;        // é–¢æ•°å®šç¾©å†…ã‹
    inClass: boolean;          // ã‚¯ãƒ©ã‚¹å®šç¾©å†…ã‹
    language: string;          // è¨€èªåï¼ˆfileTypeã‹ã‚‰åˆ¤å®šï¼‰
    syntaxGroups?: string[];   // Vimã®æ§‹æ–‡ã‚°ãƒ«ãƒ¼ãƒ—ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
  }

  export interface LineContext {
    isComment: boolean;        // ã‚³ãƒ¡ãƒ³ãƒˆè¡Œã‹
    isDocString: boolean;      // ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ–‡å­—åˆ—ã‹
    isImport: boolean;         // import/requireæ–‡ã‹
    indentLevel: number;       // ã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆãƒ¬ãƒ™ãƒ«ï¼ˆã‚¹ãƒšãƒ¼ã‚¹æ•°ï¼‰
    lineType: string;         // è¡Œã®ç¨®é¡ï¼ˆ'code', 'comment', 'string'ç­‰ï¼‰
    precedingChar?: string;    // ç›´å‰ã®æ–‡å­—ï¼ˆæ–‡è„ˆåˆ¤å®šç”¨ï¼‰
    followingChar?: string;    // ç›´å¾Œã®æ–‡å­—ï¼ˆæ–‡è„ˆåˆ¤å®šç”¨ï¼‰
  }
  ```

- [ ] **Stage 2: ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆæ¤œå‡ºå™¨ (context.ts)**
  ```typescript
  export class ContextDetector {
    private cache = new Map<string, LanguageRule>();

    // ãƒ•ã‚¡ã‚¤ãƒ«ã‚¿ã‚¤ãƒ—ã®å–å¾—
    async detectFileType(denops: Denops): Promise<string> {
      const filetype = await denops.eval('&filetype') as string;
      return filetype || 'text';
    }

    // æ§‹æ–‡ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã®æ¤œå‡º
    detectSyntaxContext(
      text: string,
      line: number,
      fileType: string
    ): SyntaxContext {
      const language = this.mapFileTypeToLanguage(fileType);
      const patterns = this.getLanguagePatterns(language);

      return {
        inComment: this.isInComment(text, patterns.commentPatterns),
        inString: this.isInString(text, patterns.stringPatterns),
        inFunction: this.isInFunction(text, patterns.functionPatterns),
        inClass: this.isInClass(text, patterns.classPatterns),
        language
      };
    }

    // è¡Œã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã®æ¤œå‡º
    detectLineContext(
      line: string,
      fileType: string
    ): LineContext {
      const indentMatch = line.match(/^(\s*)/);
      const indentLevel = indentMatch ? indentMatch[1].length : 0;

      return {
        isComment: this.isCommentLine(line, fileType),
        isDocString: this.isDocStringLine(line, fileType),
        isImport: this.isImportLine(line, fileType),
        indentLevel,
        lineType: this.detectLineType(line, fileType)
      };
    }

    // ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã«åŸºã¥ãåˆ†å‰²ãƒ«ãƒ¼ãƒ«ã®å–å¾—
    getSplittingRules(context: DetectionContext): SplittingRules {
      const fileType = context.fileType || 'text';
      const rules = this.getLanguageRules(fileType);

      // ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã«å¿œã˜ã¦ãƒ«ãƒ¼ãƒ«ã‚’èª¿æ•´
      if (context.syntaxContext?.inComment) {
        return { ...rules, splitCamelCase: false };
      }
      if (context.syntaxContext?.inString) {
        return { ...rules, preserveAll: true };
      }

      return rules;
    }
  }
  ```

- [ ] **Stage 3: ãƒ•ã‚¡ã‚¤ãƒ«ã‚¿ã‚¤ãƒ—åˆ¥ãƒ«ãƒ¼ãƒ«å®šç¾© (context.ts)**
  ```typescript
  export interface LanguageRule {
    // ãƒ‘ã‚¿ãƒ¼ãƒ³å®šç¾©
    commentPatterns: RegExp[];      // ã‚³ãƒ¡ãƒ³ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³
    stringPatterns: RegExp[];       // æ–‡å­—åˆ—ãƒ‘ã‚¿ãƒ¼ãƒ³
    functionPatterns: RegExp[];     // é–¢æ•°å®šç¾©ãƒ‘ã‚¿ãƒ¼ãƒ³
    classPatterns: RegExp[];        // ã‚¯ãƒ©ã‚¹å®šç¾©ãƒ‘ã‚¿ãƒ¼ãƒ³
    importPatterns: RegExp[];       // importæ–‡ãƒ‘ã‚¿ãƒ¼ãƒ³

    // ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã¨å‘½åè¦å‰‡
    keywords: string[];             // äºˆç´„èªãƒªã‚¹ãƒˆ
    namingConventions: {
      function: 'camelCase' | 'snake_case' | 'PascalCase';
      variable: 'camelCase' | 'snake_case' | 'UPPER_CASE';
      class: 'PascalCase';
      constant: 'UPPER_CASE';
    };

    // åˆ†å‰²è¨­å®š
    splitCamelCase: boolean;        // CamelCaseã‚’åˆ†å‰²ã™ã‚‹ã‹
    preserveSnakeCase: boolean;     // snake_caseã‚’ä¿æŒã™ã‚‹ã‹
    preserveKebabCase: boolean;     // kebab-caseã‚’ä¿æŒã™ã‚‹ã‹
    respectIndentation: boolean;    // ã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆã‚’è€ƒæ…®ã™ã‚‹ã‹
  }

  export const LANGUAGE_RULES: Record<string, LanguageRule> = {
    typescript: {
      commentPatterns: [/\/\/.*$/, /\/\*[\s\S]*?\*\//],
      stringPatterns: [/"(?:[^"\\]|\\.)*"/, /'(?:[^'\\]|\\.)*'/, /`(?:[^`\\]|\\.)*`/],
      functionPatterns: [/function\s+(\w+)/, /(\w+)\s*\([^)]*\)\s*=>/, /(\w+)\s*:\s*\([^)]*\)\s*=>/],
      classPatterns: [/class\s+(\w+)/, /interface\s+(\w+)/],
      importPatterns: [/^import\s+/, /^export\s+/],
      keywords: ['import', 'export', 'class', 'interface', 'type', 'const', 'let', 'var'],
      namingConventions: {
        function: 'camelCase',
        variable: 'camelCase',
        class: 'PascalCase',
        constant: 'UPPER_CASE'
      },
      splitCamelCase: true,
      preserveSnakeCase: false,
      preserveKebabCase: false,
      respectIndentation: true
    },

    python: {
      commentPatterns: [/#.*$/],
      stringPatterns: [/"(?:[^"\\]|\\.)*"/, /'(?:[^'\\]|\\.)*'/, /"""[\s\S]*?"""/, /'''[\s\S]*?'''/],
      functionPatterns: [/def\s+(\w+)/, /async\s+def\s+(\w+)/],
      classPatterns: [/class\s+(\w+)/],
      importPatterns: [/^import\s+/, /^from\s+.*\s+import/],
      keywords: ['import', 'from', 'class', 'def', 'if', 'for', 'while', 'with'],
      namingConventions: {
        function: 'snake_case',
        variable: 'snake_case',
        class: 'PascalCase',
        constant: 'UPPER_CASE'
      },
      splitCamelCase: false,
      preserveSnakeCase: true,
      preserveKebabCase: false,
      respectIndentation: true
    },

    markdown: {
      commentPatterns: [/<!--[\s\S]*?-->/],
      stringPatterns: [/`[^`]*`/, /```[\s\S]*?```/],
      functionPatterns: [],
      classPatterns: [],
      importPatterns: [],
      keywords: [],
      namingConventions: {
        function: 'camelCase',
        variable: 'camelCase',
        class: 'PascalCase',
        constant: 'UPPER_CASE'
      },
      splitCamelCase: false,
      preserveSnakeCase: true,
      preserveKebabCase: true,
      respectIndentation: false
    }
    // ä»–ã®è¨€èª...
  };
  ```

- [ ] **Stage 4: WordDetectorçµ±åˆ (detector.tsæ‹¡å¼µ)**
  ```typescript
  class TinySegmenterWordDetector {
    private contextDetector = new ContextDetector();

    async detectWords(
      text: string,
      startLine: number,
      context?: DetectionContext
    ): Promise<Word[]> {
      // ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆæƒ…å ±ã®å–å¾—ã¨æ‹¡å¼µ
      const enrichedContext = await this.enrichContext(context);

      // ãƒ•ã‚¡ã‚¤ãƒ«ã‚¿ã‚¤ãƒ—åˆ¥ãƒ«ãƒ¼ãƒ«ã®å–å¾—
      const rules = this.contextDetector.getSplittingRules(enrichedContext);

      // å„è¡Œã”ã¨ã«ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆèªè­˜åˆ†å‰²ã‚’å®Ÿè¡Œ
      const lines = text.split('\n');
      const allWords: Word[] = [];

      for (let i = 0; i < lines.length; i++) {
        const lineContext = this.contextDetector.detectLineContext(
          lines[i],
          enrichedContext.fileType || 'text'
        );

        // ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã«å¿œã˜ãŸåˆ†å‰²
        const words = await this.splitWithContext(
          lines[i],
          startLine + i,
          enrichedContext,
          lineContext,
          rules
        );

        allWords.push(...words);
      }

      return allWords;
    }

    private async enrichContext(
      context?: DetectionContext
    ): Promise<DetectionContext> {
      if (!context) {
        context = {};
      }

      // Vimã®filetypeã‚’å–å¾—ã—ã¦è¿½åŠ 
      if (!context.fileType && this.denops) {
        context.fileType = await this.contextDetector.detectFileType(this.denops);
      }

      return context;
    }
  }
  ```

##### ğŸ”µ Refactor Phase: æœ€é©åŒ–
- [ ] **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–**
  - [ ] ãƒ•ã‚¡ã‚¤ãƒ«ã‚¿ã‚¤ãƒ—åˆ¥ãƒ«ãƒ¼ãƒ«ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥
  - [ ] æ­£è¦è¡¨ç¾ã®äº‹å‰ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã¨ã‚­ãƒ£ãƒƒã‚·ãƒ¥
  - [ ] è¡Œã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã®å·®åˆ†æ¤œå‡º

- [ ] **ç²¾åº¦å‘ä¸Š**
  - [ ] Vimæ§‹æ–‡ã‚°ãƒ«ãƒ¼ãƒ—ã®æ´»ç”¨ï¼ˆsynIDã€synIDattrï¼‰
  - [ ] è¨€èªã‚µãƒ¼ãƒãƒ¼ãƒ—ãƒ­ãƒˆã‚³ãƒ«ï¼ˆLSPï¼‰ã¨ã®é€£æºæ¤œè¨
  - [ ] Tree-sitterãƒ™ãƒ¼ã‚¹ã®æ§‹æ–‡è§£æ

- [ ] **è¨­å®šã®å¤–éƒ¨åŒ–**
  - [ ] ãƒ¦ãƒ¼ã‚¶ãƒ¼å®šç¾©è¨€èªãƒ«ãƒ¼ãƒ«ã®ã‚µãƒãƒ¼ãƒˆ
  - [ ] ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåˆ¥è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ.hellshake-yano/languages.jsonï¼‰
  - [ ] å‹•çš„ãƒ«ãƒ¼ãƒ«æ›´æ–°æ©Ÿèƒ½

##### ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³
- [ ] **M1**: DetectionContextæ‹¡å¼µã¨ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å®šç¾©
- [ ] **M2**: ContextDetectorã‚¯ãƒ©ã‚¹ã®å®Ÿè£…
- [ ] **M3**: ä¸»è¦3è¨€èªï¼ˆTypeScriptã€Pythonã€Markdownï¼‰ã®ãƒ«ãƒ¼ãƒ«å®Ÿè£…
- [ ] **M4**: WordDetectorã¸ã®çµ±åˆã¨ãƒ†ã‚¹ãƒˆ
- [ ] **M5**: è¿½åŠ è¨€èªã‚µãƒãƒ¼ãƒˆã¨ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä½œæˆ

#### sub4 ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æ¤œå‡ºã‚¢ãƒ—ãƒ­ãƒ¼ãƒã®å¼·åŒ–ã€å„ªå…ˆåº¦: ä¸­ã€‘âœ… å®Œäº†
@target: denops/hellshake-yano/word/enhanced-hybrid.tsï¼ˆæ–°è¦ä½œæˆï¼‰
@test: denops/hellshake-yano/word/enhanced-hybrid.test.tsï¼ˆæ–°è¦ä½œæˆï¼‰
@ref: denops/hellshake-yano/word/detector.tsï¼ˆHybridWordDetectorï¼‰

##### ğŸ”´ Red Phase: ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆ
- [x] **ã‚»ã‚°ãƒ¡ãƒ³ãƒˆåˆ†æãƒ†ã‚¹ãƒˆï¼ˆ8ã‚±ãƒ¼ã‚¹ï¼‰**
  - [x] ç´”ç²‹ãªæ—¥æœ¬èªãƒ†ã‚­ã‚¹ãƒˆ
  - [x] ç´”ç²‹ãªè‹±èªãƒ†ã‚­ã‚¹ãƒˆ
  - [x] æ—¥è‹±æ··åœ¨ãƒ†ã‚­ã‚¹ãƒˆ
  - [x] ã‚³ãƒ¼ãƒ‰æ··åœ¨ãƒ†ã‚­ã‚¹ãƒˆ
  - [x] è¨˜å·ä¸»ä½“ãƒ†ã‚­ã‚¹ãƒˆ
  - [x] æ•°å€¤æ··åœ¨ãƒ†ã‚­ã‚¹ãƒˆ
  - [x] ç©ºç™½ãƒ»æ”¹è¡Œã®å‡¦ç†
  - [x] ç‰¹æ®Šæ–‡å­—ã®å‡¦ç†

- [x] **æ¤œå‡ºå™¨é¸æŠãƒ†ã‚¹ãƒˆï¼ˆ6ã‚±ãƒ¼ã‚¹ï¼‰**
  - [x] æ—¥æœ¬èªã§ã®æ¤œå‡ºå™¨é¸æŠ
  - [x] è‹±èªã§ã®æ¤œå‡ºå™¨é¸æŠ
  - [x] æ··åœ¨ã§ã®æ¤œå‡ºå™¨é¸æŠ
  - [x] ä¿¡é ¼åº¦ã«ã‚ˆã‚‹åˆ‡ã‚Šæ›¿ãˆ
  - [x] ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‹•ä½œ
  - [x] ã‚¨ãƒ©ãƒ¼æ™‚ã®å¾©æ—§

##### ğŸŸ¢ Green Phase: å®Ÿè£…
- [x] **Stage 1: EnhancedHybridWordDetectoråŸºæœ¬æ§‹é€ **
  ```typescript
  class EnhancedHybridWordDetector extends HybridWordDetector {
    private preProcessor: TextPreProcessor;
    private postProcessor: TextPostProcessor;
    private segmentAnalyzer: SegmentAnalyzer;

    async detectWords(
      text: string,
      startLine: number,
      context?: DetectionContext
    ): Promise<Word[]> {
      // å‰å‡¦ç† â†’ ã‚»ã‚°ãƒ¡ãƒ³ãƒˆåˆ†æ â†’ æ¤œå‡ºå™¨é¸æŠ â†’ å¾Œå‡¦ç†
    }
  }
  ```

- [x] **Stage 2: ã‚»ã‚°ãƒ¡ãƒ³ãƒˆåˆ†æå™¨**
  ```typescript
  interface TextSegment {
    text: string;
    type: 'japanese' | 'english' | 'mixed' | 'code' | 'symbol';
    confidence: number;
    startIndex: number;
    endIndex: number;
  }
  ```

- [x] **Stage 3: å‰å‡¦ç†ãƒ»å¾Œå‡¦ç†ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³**
  - [x] ç‰¹æ®Šãƒ‘ã‚¿ãƒ¼ãƒ³æŠ½å‡º
  - [x] çµæœã®çµ±åˆ
  - [x] é‡è¤‡é™¤å»

##### ğŸ”µ Refactor Phase: æœ€é©åŒ–
- [x] ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å‡¦ç†ã®ä¸¦åˆ—åŒ–
- [x] ãƒ¡ãƒ¢ãƒªåŠ¹ç‡ã®æ”¹å–„
- [x] æ¤œå‡ºå™¨ãƒ—ãƒ¼ãƒ«ã®å®Ÿè£…

##### ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³
- [x] **M1**: è¾æ›¸ã‚·ã‚¹ãƒ†ãƒ åŸºæœ¬å®Ÿè£…å®Œäº†
- [x] **M2**: éš£æ¥æ–‡å­—è§£æå¼·åŒ–å®Œäº†
- [x] **M3**: ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆèªè­˜å®Ÿè£…å®Œäº†
- [x] **M4**: ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æ¤œå‡ºå¼·åŒ–å®Œäº†
- [x] **M5**: çµ±åˆãƒ†ã‚¹ãƒˆåˆæ ¼
- [x] **M6**: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›®æ¨™é”æˆï¼ˆç¾çŠ¶ã®110%ä»¥å†…ï¼‰

### process10 ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ
#### sub1 è¡¨ç¤ºå¹…è¨ˆç®—ã®ãƒ†ã‚¹ãƒˆ
@target: tests/display_width_test.ts
- [ ] ASCIIæ–‡å­—ã®ãƒ†ã‚¹ãƒˆ
- [ ] ã‚¿ãƒ–æ–‡å­—ã®ãƒ†ã‚¹ãƒˆï¼ˆæ§˜ã€…ãªã‚¿ãƒ–å¹…ï¼‰
- [ ] æ—¥æœ¬èªæ–‡å­—ã®ãƒ†ã‚¹ãƒˆ
- [ ] çµµæ–‡å­—ãƒ»ç‰¹æ®Šæ–‡å­—ã®ãƒ†ã‚¹ãƒˆ
- [ ] æ··åˆæ–‡å­—åˆ—ã®ãƒ†ã‚¹ãƒˆ

#### sub2 éš£æ¥åˆ¤å®šã®ãƒ†ã‚¹ãƒˆ
@target: tests/adjacency_with_display_test.ts
- [ ] ã‚¿ãƒ–æ–‡å­—ã‚’å«ã‚€éš£æ¥åˆ¤å®š
- [ ] æ—¥æœ¬èªã‚’å«ã‚€éš£æ¥åˆ¤å®š
- [ ] ã‚¿ãƒ–ï¼‹æ—¥æœ¬èªã®çµ„ã¿åˆã‚ã›
- [ ] å¢ƒç•Œå€¤ãƒ†ã‚¹ãƒˆ
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ

### process50 ãƒ•ã‚©ãƒ­ãƒ¼ã‚¢ãƒƒãƒ—
#### sub1 è¿½åŠ ã®æœ€é©åŒ–ï¼ˆå°†æ¥ï¼‰
- [ ] Vimã®concealæ©Ÿèƒ½ã¸ã®å¯¾å¿œ
- [ ] å¯å¤‰å¹…ãƒ•ã‚©ãƒ³ãƒˆã¸ã®å¯¾å¿œ
- [ ] è¨€èªåˆ¥ã®è¡¨ç¤ºå¹…ãƒ«ãƒ¼ãƒ«

### process100 ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°
- [ ] è¡¨ç¤ºå¹…è¨ˆç®—ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–
- [ ] ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥ã®æ”¹å–„
- [ ] ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ã®å‘ä¸Š

### process200 ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³
- [ ] è¡¨ç¤ºå¹…è¨ˆç®—ã®ä»•æ§˜æ›¸ä½œæˆ
- [ ] è¨­å®šã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆåŒ–
- [ ] ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚¬ã‚¤ãƒ‰ã®ä½œæˆ
